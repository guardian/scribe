function universalModule(){function t(t,e,n,r){var i;if(r){var o=r.prototype;i=yn.create(o)}else i=t.prototype;return yn.keys(e).forEach(function(t){i[t]=e[t]}),yn.keys(n).forEach(function(e){t[e]=n[e]}),i.constructor=t,t.prototype=i,t}function e(t,e,n,r){return yn.getPrototypeOf(e)[n].apply(t,r)}function n(t,n,r){e(t,n,"constructor",r)}function r(t,e){return t===e?0!==t||0!==e||1/t===1/e:t!==t?e!==e:t&&"function"==typeof t.equals?t.equals(e):!1}function i(t,e){if(!t)throw new Error(e)}function o(t){return t.value=!1,t}function a(t){t&&(t.value=!0)}function s(){}function u(t,e){e=e||0;for(var n=Math.max(0,t.length-e),r=new Array(n),i=0;n>i;i++)r[i]=t[i+e];return r}function c(t){i(1/0!==t,"Cannot perform this action with an infinite size.")}function f(t){return void 0===t.size&&(t.size=t.__iterate(l)),t.size}function h(t,e){return e>=0?+e:f(t)+ +e}function l(){return!0}function d(t,e,n){return(0===t||void 0!==n&&-n>=t)&&(void 0===e||void 0!==n&&e>=n)}function p(t,e){return _(t,e,0)}function m(t,e){return _(t,e,e)}function _(t,e,n){return void 0===t?n:0>t?Math.max(0,e+t):void 0===e?t:Math.min(e,t)}function v(t){if(!t)return 0;if(t===!0)return 1;var e=typeof t;if("number"===e){if((0|t)===t)return t&zn;t=""+t,e="string"}return"string"===e?t.length>An?y(t):g(t):t.hashCode?v("function"==typeof t.hashCode?t.hashCode():t.hashCode):b(t)}function y(t){var e=qn[t];return void 0===e&&(e=g(t),Tn===Ln&&(Tn=0,qn={}),Tn++,qn[t]=e),e}function g(t){for(var e=0,n=0;n<t.length;n++)e=31*e+t.charCodeAt(n)&zn;return e}function b(t){var e=Nn&&Nn.get(t);if(e)return e;if(e=t[On])return e;if(!xn){if(e=t.propertyIsEnumerable&&t.propertyIsEnumerable[On])return e;if(e=w(t))return e}if(Object.isExtensible&&!Object.isExtensible(t))throw new Error("Non-extensible objects are not allowed as keys.");if(e=++In&zn,Nn)Nn.set(t,e);else if(xn)Object.defineProperty(t,On,{enumerable:!1,configurable:!1,writable:!1,value:e});else if(t.propertyIsEnumerable&&t.propertyIsEnumerable===t.constructor.prototype.propertyIsEnumerable)t.propertyIsEnumerable=function(){return this.constructor.prototype.propertyIsEnumerable.apply(this,arguments)},t.propertyIsEnumerable[On]=e;else{if(!t.nodeType)throw new Error("Unable to set a non-enumerable property on object.");t[On]=e}return e}function w(t){if(t&&t.nodeType>0)switch(t.nodeType){case 1:return t.uniqueID;case 9:return t.documentElement&&t.documentElement.uniqueID}}function S(t,e,n,r){var i=0===t?e:1===t?n:[e,n];return r?r.value=i:r={value:i,done:!1},r}function E(){return{value:void 0,done:!0}}function C(t){return!!x(t)}function M(t){return t&&"function"==typeof t.next}function k(t){var e=x(t);return e&&e.call(t)}function x(t){var e=t&&(Bn&&t[Bn]||t[Hn]);return"function"==typeof e?e:void 0}function N(t){return!(!t||!t[Jn])}function z(t){return!(!t||!t[Vn])}function I(t){return!(!t||!t[$n])}function O(t){return z(t)||I(t)}function A(t){return!(!t||!t[Qn])}function L(t,e){return e}function T(t,e){return[e,t]}function q(t){return function(){return!t.apply(this,arguments)}}function j(t){return function(){return-t.apply(this,arguments)}}function D(t){return"string"==typeof t?JSON.stringify(t):t}function R(t,e){return t>e?-1:e>t?1:0}function H(t,e){var n=!O(t)&&!O(e);if(A(t)){if(!A(e))return!1;var i=t.entries();return e.every(function(t,e){var o=i.next().value;return o&&r(o[1],t)&&(n||r(o[0],e))})&&i.next().done}var o=!1;if(void 0===t.size)if(void 0===e.size)t.cacheResult();else{o=!0;var a=t;t=e,e=a}var s=!0,u=e.__iterate(function(e,i){return(n?t.has(e):o?r(e,t.get(i,Cn)):r(t.get(i,Cn),e))?void 0:(s=!1,!1)});return s&&t.size===u}function B(t,e){var n=t.prototype,r=function(t){n[t]=e[t]};return Object.keys(e).forEach(r),Object.getOwnPropertySymbols&&Object.getOwnPropertySymbols(e).forEach(r),t}function P(t){return!(!t||!t[cr])}function U(){return pr||(pr=new fr([]))}function K(t){var e=Array.isArray(t)?new fr(t).fromEntrySeq():M(t)?new dr(t).fromEntrySeq():C(t)?new lr(t).fromEntrySeq():"object"==typeof t?new hr(t):void 0;if(!e)throw new TypeError("Expected Array or iterable object of [k, v] entries, or keyed object: "+t);return e}function F(t){var e=J(t);if(!e)throw new TypeError("Expected Array or iterable object of values: "+t);return e}function W(t){var e=J(t)||"object"==typeof t&&new hr(t);if(!e)throw new TypeError("Expected Array or iterable object of values, or keyed object: "+t);return e}function J(t){return V(t)?new fr(t):M(t)?new dr(t):C(t)?new lr(t):void 0}function V(t){return t&&"number"==typeof t.length}function $(t,e,n,r){c(t.size);var i=t._cache;if(i){for(var o=i.length-1,a=0;o>=a;a++){var s=i[n?o-a:a];if(e(s[1],r?s[0]:a,t)===!1)return a+1}return a}return t.__iterateUncached(e,n)}function Q(t,e,n,r){var i=t._cache;if(i){var o=i.length-1,a=0;return new Un(function(){var t=i[n?o-a:a];return a++>o?E():S(e,r?t[0]:a-1,t[1])})}return t.__iteratorUncached(e,n)}function X(t,e){return e?Y(e,t,"",{"":t}):G(t)}function Y(t,e,n,r){return Array.isArray(e)?t.call(r,n,or(e).map(function(n,r){return Y(t,n,r,e)})):Z(e)?t.call(r,n,rr(e).map(function(n,r){return Y(t,n,r,e)})):e}function G(t){return Array.isArray(t)?or(t).map(G).toList():Z(t)?rr(t).map(G).toMap():t}function Z(t){return t&&t.constructor===Object}function te(t){return!(!t||!t[Er])}function ee(t,e){return S(t,e[0],e[1])}function ne(t,e){return{node:t,index:0,__prev:e}}function re(t,e,n,r){var i=Object.create(Cr);return i.size=t,i._root=e,i.__ownerID=n,i.__hash=r,i.__altered=!1,i}function ie(){return jr||(jr=re(0))}function oe(t,e,n){var r,i;if(t._root){var a=o(Mn),s=o(kn);if(r=ae(t._root,t.__ownerID,0,void 0,e,n,a,s),!s.value)return t;i=t.size+(a.value?n===Cn?-1:1:0)}else{if(n===Cn)return t;i=1,r=new Mr(t.__ownerID,[[e,n]])}return t.__ownerID?(t.size=i,t._root=r,t.__hash=void 0,t.__altered=!0,t):r?re(i,r):ie()}function ae(t,e,n,r,i,o,s,u){return t?t.update(e,n,r,i,o,s,u):o===Cn?t:(a(u),a(s),new Lr(e,r,[i,o]))}function se(t){return t.constructor===Lr||t.constructor===Or}function ue(t,e,n,r,i){if(t.keyHash===r)return new Or(e,r,[t.entry,i]);var o,a=(0===n?t.keyHash:t.keyHash>>>n)&En,s=(0===n?r:r>>>n)&En,u=a===s?[ue(t,e,n+wn,r,i)]:(o=new Lr(e,r,i),s>a?[t,o]:[o,t]);return new xr(e,1<<a|1<<s,u)}function ce(t,e,n,r){t||(t=new s);for(var i=new Lr(t,v(n),[n,r]),o=0;o<e.length;o++){var a=e[o];i=i.update(t,0,void 0,a[0],a[1])}return i}function fe(t,e,n,r){for(var i=0,o=0,a=new Array(n),s=0,u=1,c=e.length;c>s;s++,u<<=1){var f=e[s];void 0!==f&&s!==r&&(i|=u,a[o++]=f)}return new xr(t,i,a)}function he(t,e,n,r,i){for(var o=0,a=new Array(Sn),s=0;0!==n;s++,n>>>=1)a[s]=1&n?e[o++]:void 0;return a[r]=i,new zr(t,o+1,a)}function le(t,e,n){for(var r=[],i=0;i<n.length;i++){var o=n[i],a=Yn(o);N(o)||(a=a.map(function(t){return X(t)})),r.push(a)}return pe(t,e,r)}function de(t){return function(e,n){return e&&e.mergeDeepWith&&N(n)?e.mergeDeepWith(t,n):t?t(e,n):n}}function pe(t,e,n){return 0===n.length?t:t.withMutations(function(t){for(var r=e?function(n,r){t.update(r,Cn,function(t){return t===Cn?n:e(t,n)})}:function(e,n){t.set(n,e)},i=0;i<n.length;i++)n[i].forEach(r)})}function me(t,e,n,r,o){i(!t||t.set,"updateIn with invalid keyPath");var a=e[o],s=t?t.get(a,Cn):Cn,u=s===Cn?void 0:s,c=o===e.length-1?r(s===Cn?n:s):me(u,e,n,r,o+1);return c===u?t:c===Cn?t&&t.remove(a):(t||ie()).set(a,c)}function _e(t){return t-=t>>1&1431655765,t=(858993459&t)+(t>>2&858993459),t=t+(t>>4)&252645135,t+=t>>8,t+=t>>16,127&t}function ve(t,e,n,r){var i=r?t:u(t);return i[e]=n,i}function ye(t,e,n,r){var i=t.length+1;if(r&&e+1===i)return t[e]=n,t;for(var o=new Array(i),a=0,s=0;i>s;s++)s===e?(o[s]=n,a=-1):o[s]=t[s+a];return o}function ge(t,e,n){var r=t.length-1;if(n&&e===r)return t.pop(),t;for(var i=new Array(r),o=0,a=0;r>a;a++)a===e&&(o=1),i[a]=t[a+o];return i}function be(t){var e=Be(t);return e._iter=t,e.size=t.size,e.flip=function(){return t},e.reverse=function(){var e=t.reverse.apply(this);return e.flip=function(){return t.reverse()},e},e.has=function(e){return t.contains(e)},e.contains=function(e){return t.has(e)},e.cacheResult=Pe,e.__iterateUncached=function(e,n){var r=this;return t.__iterate(function(t,n){return e(n,t,r)!==!1},n)},e.__iteratorUncached=function(e,n){if(e===Rn){var r=t.__iterator(e,n);return new Un(function(){var t=r.next();if(!t.done){var e=t.value[0];t.value[0]=t.value[1],t.value[1]=e}return t})}return t.__iterator(e===Dn?jn:Dn,n)},e}function we(t,e,n){var r=Be(t);return r.size=t.size,r.has=function(e){return t.has(e)},r.get=function(r,i){var o=t.get(r,Cn);return o===Cn?i:e.call(n,o,r,t)},r.__iterateUncached=function(r,i){var o=this;return t.__iterate(function(t,i,a){return r(e.call(n,t,i,a),i,o)!==!1},i)},r.__iteratorUncached=function(r,i){var o=t.__iterator(Rn,i);return new Un(function(){var i=o.next();if(i.done)return i;var a=i.value,s=a[0];return S(r,s,e.call(n,a[1],s,t),i)})},r}function Se(t,e){var n=Be(t);return n._iter=t,n.size=t.size,n.reverse=function(){return t},t.flip&&(n.flip=function(){var e=be(t);return e.reverse=function(){return t.flip()},e}),n.get=function(n,r){return t.get(e?n:-1-n,r)},n.has=function(n){return t.has(e?n:-1-n)},n.contains=function(e){return t.contains(e)},n.cacheResult=Pe,n.__iterate=function(e,n){var r=this;return t.__iterate(function(t,n){return e(t,n,r)},!n)},n.__iterator=function(e,n){return t.__iterator(e,!n)},n}function Ee(t,e,n,r){var i=Be(t);return r&&(i.has=function(r){var i=t.get(r,Cn);return i!==Cn&&!!e.call(n,i,r,t)},i.get=function(r,i){var o=t.get(r,Cn);return o!==Cn&&e.call(n,o,r,t)?o:i}),i.__iterateUncached=function(i,o){var a=this,s=0;return t.__iterate(function(t,o,u){return e.call(n,t,o,u)?(s++,i(t,r?o:s-1,a)):void 0},o),s},i.__iteratorUncached=function(i,o){var a=t.__iterator(Rn,o),s=0;return new Un(function(){for(;;){var o=a.next();if(o.done)return o;var u=o.value,c=u[0],f=u[1];if(e.call(n,f,c,t))return S(i,r?c:s++,f,o)}})},i}function Ce(t,e,n){var r=Sr().asMutable();return t.__iterate(function(i,o){r.update(e.call(n,i,o,t),0,function(t){return t+1})}),r.asImmutable()}function Me(t,e,n){var r=z(t),i=Sr().asMutable();t.__iterate(function(o,a){i.update(e.call(n,o,a,t),[],function(t){return t.push(r?[a,o]:o),t})});var o=He(t);return i.map(function(e){return je(t,o(e))})}function ke(t,e){if(e>t.size)return t;0>e&&(e=0);var n=Be(t);return n.size=t.size&&Math.min(t.size,e),n.__iterateUncached=function(n,r){var i=this;if(0===e)return 0;if(r)return this.cacheResult().__iterate(n,r);var o=0;return t.__iterate(function(t,r){return++o&&n(t,r,i)!==!1&&e>o}),o},n.__iteratorUncached=function(n,r){if(r)return this.cacheResult().__iterator(n,r);var i=e&&t.__iterator(n,r),o=0;return new Un(function(){return o++>e?E():i.next()})},n}function xe(t,e,n){var r=Be(t);return r.__iterateUncached=function(r,i){var o=this;if(i)return this.cacheResult().__iterate(r,i);var a=0;return t.__iterate(function(t,i,s){return e.call(n,t,i,s)&&++a&&r(t,i,o)}),a},r.__iteratorUncached=function(r,i){var o=this;if(i)return this.cacheResult().__iterator(r,i);var a=t.__iterator(Rn,i),s=!0;return new Un(function(){if(!s)return E();var t=a.next();if(t.done)return t;var i=t.value,u=i[0],c=i[1];return e.call(n,c,u,o)?r===Rn?t:S(r,u,c,t):(s=!1,E())})},r}function Ne(t,e,n){if(0>=e)return t;var r=Be(t);return r.size=t.size&&Math.max(0,t.size-e),r.__iterateUncached=function(r,i){var o=this;if(i)return this.cacheResult().__iterate(r,i);var a=0,s=!0,u=0;return t.__iterate(function(t,i){return s&&(s=a++<e)?void 0:(u++,r(t,n?i:u-1,o))}),u},r.__iteratorUncached=function(r,i){if(i)return this.cacheResult().__iterator(r,i);var o=e&&t.__iterator(r,i),a=0,s=0;return new Un(function(){for(;e>a;)a++,o.next();var t=o.next();return n||r===Dn?t:r===jn?S(r,s++,void 0,t):S(r,s++,t.value[1],t)})},r}function ze(t,e,n,r){var i=Be(t);return i.__iterateUncached=function(i,o){var a=this;if(o)return this.cacheResult().__iterate(i,o);var s=!0,u=0;return t.__iterate(function(t,o,c){return s&&(s=e.call(n,t,o,c))?void 0:(u++,i(t,r?o:u-1,a))}),u},i.__iteratorUncached=function(i,o){var a=this;if(o)return this.cacheResult().__iterator(i,o);var s=t.__iterator(Rn,o),u=!0,c=0;return new Un(function(){var t,o,f;do{if(t=s.next(),t.done)return r||i===Dn?t:i===jn?S(i,c++,void 0,t):S(i,c++,t.value[1],t);var h=t.value;o=h[0],f=h[1],u&&(u=e.call(n,f,o,a))}while(u);return i===Rn?t:S(i,o,f,t)})},i}function Ie(t,e){var n=z(t),r=new fr([t].concat(e)).map(function(t){return N(t)?n&&(t=Yn(t)):t=n?K(t):F(Array.isArray(t)?t:[t]),t});n?r=r.toKeyedSeq():I(t)||(r=r.toSetSeq());var i=r.flatten(!0);return i.size=r.reduce(function(t,e){if(void 0!==t){var n=e.size;if(void 0!==n)return t+n}},0),i}function Oe(t,e,n){var r=Be(t);return r.__iterateUncached=function(r,i){function o(t,u){var c=this;t.__iterate(function(t,i){return(!e||e>u)&&N(t)?o(t,u+1):r(t,n?i:a++,c)===!1&&(s=!0),!s},i)}var a=0,s=!1;return o(t,0),a},r.__iteratorUncached=function(r,i){var o=t.__iterator(r,i),a=[],s=0;return new Un(function(){for(;o;){var t=o.next();if(t.done===!1){var u=t.value;if(r===Rn&&(u=u[1]),e&&!(a.length<e)||!N(u))return n?t:S(r,s++,u,t);a.push(o),o=u.__iterator(r,i)}else o=a.pop()}return E()})},r}function Ae(t,e,n){var r=He(t);return t.toSeq().map(function(i,o){return r(e.call(n,i,o,t))}).flatten(!0)}function Le(t,e){var n=Be(t);return n.size=t.size&&2*t.size-1,n.__iterateUncached=function(n,r){var i=this,o=0;return t.__iterate(function(t){return(!o||n(e,o++,i)!==!1)&&n(t,o++,i)!==!1},r),o},n.__iteratorUncached=function(n,r){var i,o=t.__iterator(Dn,r),a=0;return new Un(function(){return(!i||a%2)&&(i=o.next(),i.done)?i:a%2?S(n,a++,e):S(n,a++,i.value,i)})},n}function Te(t,e,n){e||(e=Ue);var r=z(t),i=0,o=t.toSeq().map(function(e,r){return[r,e,i++,n?n(e,r,t):e]}).toArray();return o.sort(function(t,n){return e(t[3],n[3])||t[2]-n[2]}).forEach(r?function(t,e){o[e].length=2}:function(t,e){o[e]=t[1]}),r?rr(o):I(t)?or(o):sr(o)}function qe(t,e,n){if(e||(e=Ue),n){var r=t.toSeq().map(function(e,r){return[e,n(e,r,t)]}).reduce(function(t,n){return e(n[1],t[1])>0?n:t});return r&&r[0]}return t.reduce(function(t,n){return e(n,t)>0?n:t})}function je(t,e){return P(t)?e:t.constructor(e)}function De(t){if(t!==Object(t))throw new TypeError("Expected [K, V] tuple: "+t)}function Re(t){return c(t.size),f(t)}function He(t){return z(t)?Yn:I(t)?Zn:tr}function Be(t){return Object.create((z(t)?rr:I(t)?or:sr).prototype)}function Pe(){return this._iter.cacheResult?(this._iter.cacheResult(),this.size=this._iter.size,this):er.prototype.cacheResult.call(this)}function Ue(t,e){return t>e?1:e>t?-1:0}function Ke(t){return!(!t||!t[Wr])}function Fe(t,e,n,r,i,o){var a,s=t&&t.array;if(0===e){var u=0>n?-n:0,c=r-n;for(c>Sn&&(c=Sn),a=u;c>a;a++)if(i(s&&s[o?u+c-1-a:a])===!1)return!1}else{var f=1<<e,h=e-wn;for(a=0;En>=a;a++){var l=o?En-a:a,d=n+(l<<e);if(r>d&&d+f>0){var p=s&&s[l];if(!Fe(p,h,d,r,i,o))return!1}}}return!0}function We(t,e,n,r,i){return{array:t,level:e,offset:n,max:r,rawMax:r-n>>e,index:0,__prev:i}}function Je(t,e,n,r,i,o,a){var s=Object.create(Jr);return s.size=e-t,s._origin=t,s._capacity=e,s._level=n,s._root=r,s._tail=i,s.__ownerID=o,s.__hash=a,s.__altered=!1,s}function Ve(){return Xr||(Xr=Je(0,0,wn))}function $e(t,e,n){if(e=h(t,e),e>=t.size||0>e)return t.withMutations(function(t){0>e?Ge(t,e).set(0,n):Ge(t,0,e+1).set(e,n)});e+=t._origin;var r=t._tail,i=t._root,a=o(kn);return e>=tn(t._capacity)?r=Qe(r,t.__ownerID,0,e,n,a):i=Qe(i,t.__ownerID,t._level,e,n,a),a.value?t.__ownerID?(t._root=i,t._tail=r,t.__hash=void 0,t.__altered=!0,t):Je(t._origin,t._capacity,t._level,i,r):t}function Qe(t,e,n,r,i,o){var s=r>>>n&En,u=t&&s<t.array.length;if(!u&&void 0===i)return t;var c;if(n>0){var f=t&&t.array[s],h=Qe(f,e,n-wn,r,i,o);return h===f?t:(c=Xe(t,e),c.array[s]=h,c)}return u&&t.array[s]===i?t:(a(o),c=Xe(t,e),void 0===i&&s===c.array.length-1?c.array.pop():c.array[s]=i,c)}function Xe(t,e){return e&&t&&e===t.ownerID?t:new Vr(t?t.array.slice():[],e)}function Ye(t,e){if(e>=tn(t._capacity))return t._tail;if(e<1<<t._level+wn){for(var n=t._root,r=t._level;n&&r>0;)n=n.array[e>>>r&En],r-=wn;return n}}function Ge(t,e,n){var r=t.__ownerID||new s,i=t._origin,o=t._capacity,a=i+e,u=void 0===n?o:0>n?o+n:i+n;if(a===i&&u===o)return t;if(a>=u)return t.clear();for(var c=t._level,f=t._root,h=0;0>a+h;)f=new Vr(f&&f.array.length?[void 0,f]:[],r),c+=wn,h+=1<<c;h&&(a+=h,i+=h,u+=h,o+=h);for(var l=tn(o),d=tn(u);d>=1<<c+wn;)f=new Vr(f&&f.array.length?[f]:[],r),c+=wn;var p=t._tail,m=l>d?Ye(t,u-1):d>l?new Vr([],r):p;if(p&&d>l&&o>a&&p.array.length){f=Xe(f,r);for(var _=f,v=c;v>wn;v-=wn){var y=l>>>v&En;_=_.array[y]=Xe(_.array[y],r)}_.array[l>>>wn&En]=p}if(o>u&&(m=m&&m.removeAfter(r,0,u)),a>=d)a-=d,u-=d,c=wn,f=null,m=m&&m.removeBefore(r,0,a);else if(a>i||l>d){for(h=0;f;){var g=a>>>c&En;if(g!==d>>>c&En)break;g&&(h+=(1<<c)*g),c-=wn,f=f.array[g]}f&&a>i&&(f=f.removeBefore(r,c,a-h)),f&&l>d&&(f=f.removeAfter(r,c,d-h)),h&&(a-=h,u-=h)}return t.__ownerID?(t.size=u-a,t._origin=a,t._capacity=u,t._level=c,t._root=f,t._tail=m,t.__hash=void 0,t.__altered=!0,t):Je(a,u,c,f,m)}function Ze(t,e,n){for(var r=[],i=0,o=0;o<n.length;o++){var a=n[o],s=Zn(a);s.size>i&&(i=s.size),N(a)||(s=s.map(function(t){return X(t)})),r.push(s)}return i>t.size&&(t=t.setSize(i)),pe(t,e,r)}function tn(t){return Sn>t?0:t-1>>>wn<<wn}function en(t){return te(t)&&A(t)}function nn(t,e,n,r){var i=Object.create(Yr.prototype);return i.size=t?t.size:0,i._map=t,i._list=e,i.__ownerID=n,i.__hash=r,i}function rn(){return Gr||(Gr=nn(ie(),Ve()))}function on(t,e,n){var r,i,o=t._map,a=t._list,s=o.get(e),u=void 0!==s;if(n===Cn){if(!u)return t;a.size>=Sn&&a.size>=2*o.size?(i=a.filter(function(t,e){return void 0!==t&&s!==e}),r=i.toKeyedSeq().map(function(t){return t[0]}).flip().toMap(),t.__ownerID&&(r.__ownerID=i.__ownerID=t.__ownerID)):(r=o.remove(e),i=s===a.size-1?a.pop():a.set(s,void 0))}else if(u){if(n===a.get(s)[1])return t;r=o,i=a.set(s,[e,n])}else r=o.set(e,a.size),i=a.set(a.size,[e,n]);return t.__ownerID?(t.size=r.size,t._map=r,t._list=i,t.__hash=void 0,t):nn(r,i)}function an(t){return!(!t||!t[ei])}function sn(t,e,n,r){var i=Object.create(ni);return i.size=t,i._head=e,i.__ownerID=n,i.__hash=r,i.__altered=!1,i}function un(){return ri||(ri=sn(0))}function cn(t){return!(!t||!t[oi])}function fn(t,e){return t.__ownerID?(t.size=e.size,t._map=e,t):e===t._map?t:0===e.size?t.__empty():t.__make(e)}function hn(t,e){var n=Object.create(ai);return n.size=t?t.size:0,n._map=t,n.__ownerID=e,n}function ln(){return si||(si=hn(ie()))}function dn(t){return cn(t)&&A(t)}function pn(t,e){var n=Object.create(ci);return n.size=t?t.size:0,n._map=t,n.__ownerID=e,n}function mn(){return fi||(fi=pn(rn()))}function _n(t,e,n){var r=Object.create(Object.getPrototypeOf(t));return r._map=e,r.__ownerID=n,r}function vn(t){return t._name||t.constructor.name}var yn=Object,gn={};gn.createClass=t,gn.superCall=e,gn.defaultSuperCall=n;var bn="delete",wn=5,Sn=1<<wn,En=Sn-1,Cn={},Mn={value:!1},kn={value:!1},xn=function(){try{return Object.defineProperty({},"x",{}),!0}catch(t){return!1}}(),Nn="function"==typeof WeakMap&&new WeakMap,zn=2147483647,In=0,On="__immutablehash__";"function"==typeof Symbol&&(On=Symbol(On));var An=16,Ln=255,Tn=0,qn={},jn=0,Dn=1,Rn=2,Hn="@@iterator",Bn="function"==typeof Symbol&&Symbol.iterator,Pn=Bn||Hn,Un=function(t){this.next=t};gn.createClass(Un,{toString:function(){return"[Iterator]"}},{}),Un.KEYS=jn,Un.VALUES=Dn,Un.ENTRIES=Rn;var Kn=Un.prototype;Kn.inspect=Kn.toSource=function(){return this.toString()},Kn[Pn]=function(){return this};var Fn=function(t){return N(t)?t:er(t)},Wn=Fn;gn.createClass(Fn,{toArray:function(){c(this.size);var t=new Array(this.size||0);return this.valueSeq().__iterate(function(e,n){t[n]=e}),t},toIndexedSeq:function(){return new Pr(this)},toJS:function(){return this.toSeq().map(function(t){return t&&"function"==typeof t.toJS?t.toJS():t}).__toJS()},toKeyedSeq:function(){return new Br(this,!0)},toMap:function(){return c(this.size),Sr(this.toKeyedSeq())},toObject:function(){c(this.size);var t={};return this.__iterate(function(e,n){t[n]=e}),t},toOrderedMap:function(){return c(this.size),Yr(this.toKeyedSeq())},toOrderedSet:function(){return c(this.size),ui(z(this)?this.valueSeq():this)},toSet:function(){return c(this.size),ii(z(this)?this.valueSeq():this)},toSetSeq:function(){return new Ur(this)},toSeq:function(){return I(this)?this.toIndexedSeq():z(this)?this.toKeyedSeq():this.toSetSeq()},toStack:function(){return c(this.size),Zr(z(this)?this.valueSeq():this)},toList:function(){return c(this.size),Fr(z(this)?this.valueSeq():this)},toString:function(){return"[Iterable]"},__toString:function(t,e){return 0===this.size?t+e:t+" "+this.toSeq().map(this.__toStringMapper).join(", ")+" "+e},concat:function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return je(this,Ie(this,t))},contains:function(t){return this.some(function(e){return r(e,t)})},entries:function(){return this.__iterator(Rn)},every:function(t,e){var n=!0;return this.__iterate(function(r,i,o){return t.call(e,r,i,o)?void 0:(n=!1,!1)}),n},filter:function(t,e){return je(this,Ee(this,t,e,!0))},find:function(t,e,n){var r=n;return this.__iterate(function(n,i,o){return t.call(e,n,i,o)?(r=n,!1):void 0}),r},forEach:function(t,e){return this.__iterate(e?t.bind(e):t)},join:function(t){t=void 0!==t?""+t:",";var e="",n=!0;return this.__iterate(function(r){n?n=!1:e+=t,e+=null!==r&&void 0!==r?r:""}),e},keys:function(){return this.__iterator(jn)},map:function(t,e){return je(this,we(this,t,e))},reduce:function(t,e,n){var r,i;return arguments.length<2?i=!0:r=e,this.__iterate(function(e,o,a){i?(i=!1,r=e):r=t.call(n,r,e,o,a)}),r},reduceRight:function(){var t=this.toKeyedSeq().reverse();return t.reduce.apply(t,arguments)},reverse:function(){return je(this,Se(this,!0))},slice:function(t,e){if(d(t,e,this.size))return this;var n=p(t,this.size),r=m(e,this.size);if(n!==n||r!==r)return this.toSeq().cacheResult().slice(t,e);var i=0===n?this:this.skip(n);return je(this,void 0===r||r===this.size?i:i.take(r-n))},some:function(t,e){return!this.every(q(t),e)},sort:function(t){return je(this,Te(this,t))},values:function(){return this.__iterator(Dn)},butLast:function(){return this.slice(0,-1)},count:function(t,e){return f(t?this.toSeq().filter(t,e):this)},countBy:function(t,e){return Ce(this,t,e)},equals:function(t){if(this===t)return!0;if(!t||"function"!=typeof t.equals)return!1;if(void 0!==this.size&&void 0!==t.size){if(this.size!==t.size)return!1;if(0===this.size&&0===t.size)return!0}return void 0!==this.__hash&&void 0!==t.__hash&&this.__hash!==t.__hash?!1:this.__deepEquals(t)},__deepEquals:function(t){return H(this,t)},entrySeq:function(){var t=this;if(t._cache)return new fr(t._cache);var e=t.toSeq().map(T).toIndexedSeq();return e.fromEntrySeq=function(){return t.toSeq()},e},filterNot:function(t,e){return this.filter(q(t),e)},findLast:function(t,e,n){return this.toKeyedSeq().reverse().find(t,e,n)},first:function(){return this.find(l)},flatMap:function(t,e){return je(this,Ae(this,t,e))},flatten:function(t){return je(this,Oe(this,t,!0))},fromEntrySeq:function(){return new Kr(this)},get:function(t,e){return this.find(function(e,n){return r(n,t)},void 0,e)},getIn:function(t,e){var n=this;if(t)for(var r=0;r<t.length;r++)if(n=n&&n.get?n.get(t[r],Cn):Cn,n===Cn)return e;return n},groupBy:function(t,e){return Me(this,t,e)},has:function(t){return this.get(t,Cn)!==Cn},isSubset:function(t){return t="function"==typeof t.contains?t:Wn(t),this.every(function(e){return t.contains(e)})},isSuperset:function(t){return t.isSubset(this)},keySeq:function(){return this.toSeq().map(L).toIndexedSeq()},last:function(){return this.toSeq().reverse().first()},max:function(t){return qe(this,t)},maxBy:function(t,e){return qe(this,e,t)},min:function(t){return qe(this,t?j(t):R)},minBy:function(t,e){return qe(this,e?j(e):R,t)},rest:function(){return this.slice(1)},skip:function(t){return je(this,Ne(this,t,!0))},skipLast:function(t){return je(this,this.toSeq().reverse().skip(t).reverse())},skipWhile:function(t,e){return je(this,ze(this,t,e,!0))},skipUntil:function(t,e){return this.skipWhile(q(t),e)},sortBy:function(t,e){return je(this,Te(this,e,t))},take:function(t){return je(this,ke(this,t))},takeLast:function(t){return je(this,this.toSeq().reverse().take(t).reverse())},takeWhile:function(t,e){return je(this,xe(this,t,e))},takeUntil:function(t,e){return this.takeWhile(q(t),e)},valueSeq:function(){return this.toIndexedSeq()},hashCode:function(){return this.__hash||(this.__hash=1/0===this.size?0:this.reduce(function(t,e,n){return t+(v(e)^(e===n?0:v(n)))&zn},0))}},{});var Jn="@@__IMMUTABLE_ITERABLE__@@",Vn="@@__IMMUTABLE_KEYED__@@",$n="@@__IMMUTABLE_INDEXED__@@",Qn="@@__IMMUTABLE_ORDERED__@@",Xn=Fn.prototype;Xn[Jn]=!0,Xn[Pn]=Xn.values,Xn.toJSON=Xn.toJS,Xn.__toJS=Xn.toArray,Xn.__toStringMapper=D,Xn.inspect=Xn.toSource=function(){return this.toString()},Xn.chain=Xn.flatMap,function(){try{Object.defineProperty(Xn,"length",{get:function(){if(!Fn.noLengthWarning){var t;try{throw new Error}catch(e){t=e.stack}if(-1===t.indexOf("_wrapObject"))return console&&console.warn&&console.warn("iterable.length has been deprecated, use iterable.size or iterable.count(). This warning will become a silent error in a future version. "+t),this.size}}})}catch(t){}}();var Yn=function(t){return z(t)?t:rr(t)};gn.createClass(Yn,{flip:function(){return je(this,be(this))},findKey:function(t,e){var n;return this.__iterate(function(r,i,o){return t.call(e,r,i,o)?(n=i,!1):void 0}),n},findLastKey:function(t,e){return this.toSeq().reverse().findKey(t,e)},keyOf:function(t){return this.findKey(function(e){return r(e,t)})},lastKeyOf:function(t){return this.toSeq().reverse().keyOf(t)},mapEntries:function(t,e){var n=this,r=0;return je(this,this.toSeq().map(function(i,o){return t.call(e,[o,i],r++,n)}).fromEntrySeq())},mapKeys:function(t,e){var n=this;return je(this,this.toSeq().flip().map(function(r,i){return t.call(e,r,i,n)}).flip())}},{},Fn);var Gn=Yn.prototype;Gn[Vn]=!0,Gn[Pn]=Xn.entries,Gn.__toJS=Xn.toObject,Gn.__toStringMapper=function(t,e){return e+": "+D(t)};var Zn=function(t){return I(t)?t:or(t)};gn.createClass(Zn,{toKeyedSeq:function(){return new Br(this,!1)},filter:function(t,e){return je(this,Ee(this,t,e,!1))},findIndex:function(t,e){var n=this.toKeyedSeq().findKey(t,e);return void 0===n?-1:n},indexOf:function(t){var e=this.toKeyedSeq().keyOf(t);return void 0===e?-1:e},lastIndexOf:function(t){var e=this.toKeyedSeq().lastKeyOf(t);return void 0===e?-1:e},reverse:function(){return je(this,Se(this,!1))},splice:function(t,e){var n=arguments.length;if(e=Math.max(0|e,0),0===n||2===n&&!e)return this;t=p(t,this.size);var r=this.slice(0,t);return je(this,1===n?r:r.concat(u(arguments,2),this.slice(t+e)))},findLastIndex:function(t,e){var n=this.toKeyedSeq().findLastKey(t,e);return void 0===n?-1:n},first:function(){return this.get(0)},flatten:function(t){return je(this,Oe(this,t,!1))},get:function(t,e){return t=h(this,t),0>t||1/0===this.size||void 0!==this.size&&t>this.size?e:this.find(function(e,n){return n===t},void 0,e)},has:function(t){return t=h(this,t),t>=0&&(void 0!==this.size?1/0===this.size||t<this.size:-1!==this.indexOf(t))},interpose:function(t){return je(this,Le(this,t))},last:function(){return this.get(-1)},skip:function(t){var e=this,n=Ne(e,t,!1);return P(e)&&n!==e&&(n.get=function(n,r){return n=h(this,n),n>=0?e.get(n+t,r):r}),je(this,n)},skipWhile:function(t,e){return je(this,ze(this,t,e,!1))},take:function(t){var e=this,n=ke(e,t);return P(e)&&n!==e&&(n.get=function(n,r){return n=h(this,n),n>=0&&t>n?e.get(n,r):r}),je(this,n)}},{},Fn),Zn.prototype[$n]=!0,Zn.prototype[Qn]=!0;var tr=function(t){return N(t)&&!O(t)?t:sr(t)};gn.createClass(tr,{get:function(t,e){return this.has(t)?t:e},contains:function(t){return this.has(t)},keySeq:function(){return this.valueSeq()}},{},Fn),tr.prototype.has=Xn.contains,Fn.isIterable=N,Fn.isKeyed=z,Fn.isIndexed=I,Fn.isAssociative=O,Fn.isOrdered=A,Fn.Keyed=Yn,Fn.Indexed=Zn,Fn.Set=tr,Fn.Iterator=Un;var er=function(t){return null===t||void 0===t?U():N(t)?t.toSeq():W(t)},nr=er;gn.createClass(er,{toSeq:function(){return this},toString:function(){return this.__toString("Seq {","}")},cacheResult:function(){return!this._cache&&this.__iterateUncached&&(this._cache=this.entrySeq().toArray(),this.size=this._cache.length),this},__iterate:function(t,e){return $(this,t,e,!0)},__iterator:function(t,e){return Q(this,t,e,!0)}},{of:function(){return nr(arguments)}},Fn);var rr=function(t){return null===t||void 0===t?U().toKeyedSeq():N(t)?z(t)?t.toSeq():t.fromEntrySeq():K(t)},ir=rr;gn.createClass(rr,{toKeyedSeq:function(){return this},toSeq:function(){return this}},{of:function(){return ir(arguments)}},er),B(rr,Yn.prototype);var or=function(t){return null===t||void 0===t?U():N(t)?z(t)?t.entrySeq():t.toIndexedSeq():F(t)},ar=or;gn.createClass(or,{toIndexedSeq:function(){return this},toString:function(){return this.__toString("Seq [","]")},__iterate:function(t,e){return $(this,t,e,!1)},__iterator:function(t,e){return Q(this,t,e,!1)}},{of:function(){return ar(arguments)}},er),B(or,Zn.prototype);var sr=function(t){return(null===t||void 0===t?U():N(t)?z(t)?t.entrySeq():t:F(t)).toSetSeq()},ur=sr;gn.createClass(sr,{toSetSeq:function(){return this}},{of:function(){return ur(arguments)}},er),B(sr,tr.prototype),er.isSeq=P,er.Keyed=rr,er.Set=sr,er.Indexed=or;var cr="@@__IMMUTABLE_SEQ__@@";er.prototype[cr]=!0;var fr=function(t){this._array=t,this.size=t.length};gn.createClass(fr,{get:function(t,e){return this.has(t)?this._array[h(this,t)]:e},__iterate:function(t,e){for(var n=this._array,r=n.length-1,i=0;r>=i;i++)if(t(n[e?r-i:i],i,this)===!1)return i+1;return i},__iterator:function(t,e){var n=this._array,r=n.length-1,i=0;return new Un(function(){return i>r?E():S(t,i,n[e?r-i++:i++])})}},{},or);var hr=function(t){var e=Object.keys(t);this._object=t,this._keys=e,this.size=e.length};gn.createClass(hr,{get:function(t,e){return void 0===e||this.has(t)?this._object[t]:e},has:function(t){return this._object.hasOwnProperty(t)},__iterate:function(t,e){for(var n=this._object,r=this._keys,i=r.length-1,o=0;i>=o;o++){var a=r[e?i-o:o];if(t(n[a],a,this)===!1)return o+1}return o},__iterator:function(t,e){var n=this._object,r=this._keys,i=r.length-1,o=0;return new Un(function(){var a=r[e?i-o:o];return o++>i?E():S(t,a,n[a])})}},{},rr),hr.prototype[Qn]=!0;var lr=function(t){this._iterable=t,this.size=t.length||t.size};gn.createClass(lr,{__iterateUncached:function(t,e){if(e)return this.cacheResult().__iterate(t,e);var n=this._iterable,r=k(n),i=0;if(M(r))for(var o;!(o=r.next()).done&&t(o.value,i++,this)!==!1;);return i},__iteratorUncached:function(t,e){if(e)return this.cacheResult().__iterator(t,e);var n=this._iterable,r=k(n);if(!M(r))return new Un(E);var i=0;return new Un(function(){var e=r.next();return e.done?e:S(t,i++,e.value)})}},{},or);var dr=function(t){this._iterator=t,this._iteratorCache=[]};gn.createClass(dr,{__iterateUncached:function(t,e){if(e)return this.cacheResult().__iterate(t,e);for(var n=this._iterator,r=this._iteratorCache,i=0;i<r.length;)if(t(r[i],i++,this)===!1)return i;for(var o;!(o=n.next()).done;){var a=o.value;if(r[i]=a,t(a,i++,this)===!1)break}return i},__iteratorUncached:function(t,e){if(e)return this.cacheResult().__iterator(t,e);var n=this._iterator,r=this._iteratorCache,i=0;return new Un(function(){if(i>=r.length){var e=n.next();if(e.done)return e;r[i]=e.value}return S(t,i,r[i++])})}},{},or);var pr,mr=function(){throw TypeError("Abstract")};gn.createClass(mr,{},{},Fn);var _r=function(){gn.defaultSuperCall(this,vr.prototype,arguments)},vr=_r;gn.createClass(_r,{},{},mr),B(_r,Yn.prototype);var yr=function(){gn.defaultSuperCall(this,gr.prototype,arguments)},gr=yr;gn.createClass(yr,{},{},mr),B(yr,Zn.prototype);var br=function(){gn.defaultSuperCall(this,wr.prototype,arguments)},wr=br;gn.createClass(br,{},{},mr),B(br,tr.prototype),mr.Keyed=_r,mr.Indexed=yr,mr.Set=br;var Sr=function(t){return null===t||void 0===t?ie():te(t)?t:ie().merge(Yn(t))};gn.createClass(Sr,{toString:function(){return this.__toString("Map {","}")},get:function(t,e){return this._root?this._root.get(0,void 0,t,e):e},set:function(t,e){return oe(this,t,e)},setIn:function(t,e){return i(t.length>0,"Requires non-empty key path."),this.updateIn(t,function(){return e
})},remove:function(t){return oe(this,t,Cn)},removeIn:function(t){return i(t.length>0,"Requires non-empty key path."),this.updateIn(t,function(){return Cn})},update:function(t,e,n){return 1===arguments.length?t(this):this.updateIn([t],e,n)},updateIn:function(t,e,n){return n||(n=e,e=void 0),0===t.length?n(this):me(this,t,e,n,0)},clear:function(){return 0===this.size?this:this.__ownerID?(this.size=0,this._root=null,this.__hash=void 0,this.__altered=!0,this):ie()},merge:function(){return le(this,void 0,arguments)},mergeWith:function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];return le(this,t,e)},mergeDeep:function(){return le(this,de(void 0),arguments)},mergeDeepWith:function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];return le(this,de(t),e)},sort:function(t){return Yr(Te(this,t))},sortBy:function(t,e){return Yr(Te(this,e,t))},withMutations:function(t){var e=this.asMutable();return t(e),e.wasAltered()?e.__ensureOwner(this.__ownerID):this},asMutable:function(){return this.__ownerID?this:this.__ensureOwner(new s)},asImmutable:function(){return this.__ensureOwner()},wasAltered:function(){return this.__altered},__iterator:function(t,e){return new qr(this,t,e)},__iterate:function(t,e){var n=this,r=0;return this._root&&this._root.iterate(function(e){return r++,t(e[1],e[0],n)},e),r},__ensureOwner:function(t){return t===this.__ownerID?this:t?re(this.size,this._root,t,this.__hash):(this.__ownerID=t,this.__altered=!1,this)}},{},_r),Sr.isMap=te;var Er="@@__IMMUTABLE_MAP__@@",Cr=Sr.prototype;Cr[Er]=!0,Cr[bn]=Cr.remove;var Mr=function(t,e){this.ownerID=t,this.entries=e},kr=Mr;gn.createClass(Mr,{get:function(t,e,n,i){for(var o=this.entries,a=0,s=o.length;s>a;a++)if(r(n,o[a][0]))return o[a][1];return i},update:function(t,e,n,i,o,s,c){for(var f=o===Cn,h=this.entries,l=0,d=h.length;d>l&&!r(i,h[l][0]);l++);var p=d>l;if(p?h[l][1]===o:f)return this;if(a(c),(f||!p)&&a(s),!f||1!==h.length){if(!p&&!f&&h.length>=Dr)return ce(t,h,i,o);var m=t&&t===this.ownerID,_=m?h:u(h);return p?f?l===d-1?_.pop():_[l]=_.pop():_[l]=[i,o]:_.push([i,o]),m?(this.entries=_,this):new kr(t,_)}}},{});var xr=function(t,e,n){this.ownerID=t,this.bitmap=e,this.nodes=n},Nr=xr;gn.createClass(xr,{get:function(t,e,n,r){void 0===e&&(e=v(n));var i=1<<((0===t?e:e>>>t)&En),o=this.bitmap;return 0===(o&i)?r:this.nodes[_e(o&i-1)].get(t+wn,e,n,r)},update:function(t,e,n,r,i,o,a){void 0===n&&(n=v(r));var s=(0===e?n:n>>>e)&En,u=1<<s,c=this.bitmap,f=0!==(c&u);if(!f&&i===Cn)return this;var h=_e(c&u-1),l=this.nodes,d=f?l[h]:void 0,p=ae(d,t,e+wn,n,r,i,o,a);if(p===d)return this;if(!f&&p&&l.length>=Rr)return he(t,l,c,s,p);if(f&&!p&&2===l.length&&se(l[1^h]))return l[1^h];if(f&&p&&1===l.length&&se(p))return p;var m=t&&t===this.ownerID,_=f?p?c:c^u:c|u,y=f?p?ve(l,h,p,m):ge(l,h,m):ye(l,h,p,m);return m?(this.bitmap=_,this.nodes=y,this):new Nr(t,_,y)}},{});var zr=function(t,e,n){this.ownerID=t,this.count=e,this.nodes=n},Ir=zr;gn.createClass(zr,{get:function(t,e,n,r){void 0===e&&(e=v(n));var i=(0===t?e:e>>>t)&En,o=this.nodes[i];return o?o.get(t+wn,e,n,r):r},update:function(t,e,n,r,i,o,a){void 0===n&&(n=v(r));var s=(0===e?n:n>>>e)&En,u=i===Cn,c=this.nodes,f=c[s];if(u&&!f)return this;var h=ae(f,t,e+wn,n,r,i,o,a);if(h===f)return this;var l=this.count;if(f){if(!h&&(l--,Hr>l))return fe(t,c,l,s)}else l++;var d=t&&t===this.ownerID,p=ve(c,s,h,d);return d?(this.count=l,this.nodes=p,this):new Ir(t,l,p)}},{});var Or=function(t,e,n){this.ownerID=t,this.keyHash=e,this.entries=n},Ar=Or;gn.createClass(Or,{get:function(t,e,n,i){for(var o=this.entries,a=0,s=o.length;s>a;a++)if(r(n,o[a][0]))return o[a][1];return i},update:function(t,e,n,i,o,s,c){void 0===n&&(n=v(i));var f=o===Cn;if(n!==this.keyHash)return f?this:(a(c),a(s),ue(this,t,e,n,[i,o]));for(var h=this.entries,l=0,d=h.length;d>l&&!r(i,h[l][0]);l++);var p=d>l;if(p?h[l][1]===o:f)return this;if(a(c),(f||!p)&&a(s),f&&2===d)return new Lr(t,this.keyHash,h[1^l]);var m=t&&t===this.ownerID,_=m?h:u(h);return p?f?l===d-1?_.pop():_[l]=_.pop():_[l]=[i,o]:_.push([i,o]),m?(this.entries=_,this):new Ar(t,this.keyHash,_)}},{});var Lr=function(t,e,n){this.ownerID=t,this.keyHash=e,this.entry=n},Tr=Lr;gn.createClass(Lr,{get:function(t,e,n,i){return r(n,this.entry[0])?this.entry[1]:i},update:function(t,e,n,i,o,s,u){var c=o===Cn,f=r(i,this.entry[0]);return(f?o===this.entry[1]:c)?this:(a(u),c?void a(s):f?t&&t===this.ownerID?(this.entry[1]=o,this):new Tr(t,this.keyHash,[i,o]):(a(s),ue(this,t,e,v(i),[i,o])))}},{}),Mr.prototype.iterate=Or.prototype.iterate=function(t,e){for(var n=this.entries,r=0,i=n.length-1;i>=r;r++)if(t(n[e?i-r:r])===!1)return!1},xr.prototype.iterate=zr.prototype.iterate=function(t,e){for(var n=this.nodes,r=0,i=n.length-1;i>=r;r++){var o=n[e?i-r:r];if(o&&o.iterate(t,e)===!1)return!1}},Lr.prototype.iterate=function(t){return t(this.entry)};var qr=function(t,e,n){this._type=e,this._reverse=n,this._stack=t._root&&ne(t._root)};gn.createClass(qr,{next:function(){for(var t=this._type,e=this._stack;e;){var n,r=e.node,i=e.index++;if(r.entry){if(0===i)return ee(t,r.entry)}else if(r.entries){if(n=r.entries.length-1,n>=i)return ee(t,r.entries[this._reverse?n-i:i])}else if(n=r.nodes.length-1,n>=i){var o=r.nodes[this._reverse?n-i:i];if(o){if(o.entry)return ee(t,o.entry);e=this._stack=ne(o,e)}continue}e=this._stack=this._stack.__prev}return E()}},{},Un);var jr,Dr=Sn/4,Rr=Sn/2,Hr=Sn/4,Br=function(t,e){this._iter=t,this._useKeys=e,this.size=t.size};gn.createClass(Br,{get:function(t,e){return this._iter.get(t,e)},has:function(t){return this._iter.has(t)},valueSeq:function(){return this._iter.valueSeq()},reverse:function(){var t=this,e=Se(this,!0);return this._useKeys||(e.valueSeq=function(){return t._iter.toSeq().reverse()}),e},map:function(t,e){var n=this,r=we(this,t,e);return this._useKeys||(r.valueSeq=function(){return n._iter.toSeq().map(t,e)}),r},__iterate:function(t,e){var n,r=this;return this._iter.__iterate(this._useKeys?function(e,n){return t(e,n,r)}:(n=e?Re(this):0,function(i){return t(i,e?--n:n++,r)}),e)},__iterator:function(t,e){if(this._useKeys)return this._iter.__iterator(t,e);var n=this._iter.__iterator(Dn,e),r=e?Re(this):0;return new Un(function(){var i=n.next();return i.done?i:S(t,e?--r:r++,i.value,i)})}},{},rr),Br.prototype[Qn]=!0;var Pr=function(t){this._iter=t,this.size=t.size};gn.createClass(Pr,{contains:function(t){return this._iter.contains(t)},__iterate:function(t,e){var n=this,r=0;return this._iter.__iterate(function(e){return t(e,r++,n)},e)},__iterator:function(t,e){var n=this._iter.__iterator(Dn,e),r=0;return new Un(function(){var e=n.next();return e.done?e:S(t,r++,e.value,e)})}},{},or);var Ur=function(t){this._iter=t,this.size=t.size};gn.createClass(Ur,{has:function(t){return this._iter.contains(t)},__iterate:function(t,e){var n=this;return this._iter.__iterate(function(e){return t(e,e,n)},e)},__iterator:function(t,e){var n=this._iter.__iterator(Dn,e);return new Un(function(){var e=n.next();return e.done?e:S(t,e.value,e.value,e)})}},{},sr);var Kr=function(t){this._iter=t,this.size=t.size};gn.createClass(Kr,{entrySeq:function(){return this._iter.toSeq()},__iterate:function(t,e){var n=this;return this._iter.__iterate(function(e){return e?(De(e),t(e[1],e[0],n)):void 0},e)},__iterator:function(t,e){var n=this._iter.__iterator(Dn,e);return new Un(function(){for(;;){var e=n.next();if(e.done)return e;var r=e.value;if(r)return De(r),t===Rn?e:S(t,r[0],r[1],e)}})}},{},rr),Pr.prototype.cacheResult=Br.prototype.cacheResult=Ur.prototype.cacheResult=Kr.prototype.cacheResult=Pe;var Fr=function(t){var e=Ve();if(null===t||void 0===t)return e;if(Ke(t))return t;t=Zn(t);var n=t.size;return 0===n?e:n>0&&Sn>n?Je(0,n,wn,null,new Vr(t.toArray())):e.merge(t)};gn.createClass(Fr,{toString:function(){return this.__toString("List [","]")},get:function(t,e){if(t=h(this,t),0>t||t>=this.size)return e;t+=this._origin;var n=Ye(this,t);return n&&n.array[t&En]},set:function(t,e){return $e(this,t,e)},remove:function(t){return this.has(t)?0===t?this.shift():t===this.size-1?this.pop():this.splice(t,1):this},clear:function(){return 0===this.size?this:this.__ownerID?(this.size=this._origin=this._capacity=0,this._level=wn,this._root=this._tail=null,this.__hash=void 0,this.__altered=!0,this):Ve()},push:function(){var t=arguments,e=this.size;return this.withMutations(function(n){Ge(n,0,e+t.length);for(var r=0;r<t.length;r++)n.set(e+r,t[r])})},pop:function(){return Ge(this,0,-1)},unshift:function(){var t=arguments;return this.withMutations(function(e){Ge(e,-t.length);for(var n=0;n<t.length;n++)e.set(n,t[n])})},shift:function(){return Ge(this,1)},merge:function(){return Ze(this,void 0,arguments)},mergeWith:function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];return Ze(this,t,e)},mergeDeep:function(){return Ze(this,de(void 0),arguments)},mergeDeepWith:function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];return Ze(this,de(t),e)},setSize:function(t){return Ge(this,0,t)},slice:function(t,e){var n=this.size;return d(t,e,n)?this:Ge(this,p(t,n),m(e,n))},__iterator:function(t,e){return new Qr(this,t,e)},__iterate:function(t,e){var n=this,r=0,i=function(e){return t(e,r++,n)},o=tn(this._capacity);return e?Fe(this._tail,0,o-this._origin,this._capacity-this._origin,i,e)&&Fe(this._root,this._level,-this._origin,o-this._origin,i,e):Fe(this._root,this._level,-this._origin,o-this._origin,i,e)&&Fe(this._tail,0,o-this._origin,this._capacity-this._origin,i,e),r},__ensureOwner:function(t){return t===this.__ownerID?this:t?Je(this._origin,this._capacity,this._level,this._root,this._tail,t,this.__hash):(this.__ownerID=t,this)}},{of:function(){return this(arguments)}},yr),Fr.isList=Ke;var Wr="@@__IMMUTABLE_LIST__@@",Jr=Fr.prototype;Jr[Wr]=!0,Jr[bn]=Jr.remove,Jr.setIn=Cr.setIn,Jr.removeIn=Cr.removeIn,Jr.update=Cr.update,Jr.updateIn=Cr.updateIn,Jr.withMutations=Cr.withMutations,Jr.asMutable=Cr.asMutable,Jr.asImmutable=Cr.asImmutable,Jr.wasAltered=Cr.wasAltered;var Vr=function(t,e){this.array=t,this.ownerID=e},$r=Vr;gn.createClass(Vr,{removeBefore:function(t,e,n){if(n===e?1<<e:0||0===this.array.length)return this;var r=n>>>e&En;if(r>=this.array.length)return new $r([],t);var i,o=0===r;if(e>0){var a=this.array[r];if(i=a&&a.removeBefore(t,e-wn,n),i===a&&o)return this}if(o&&!i)return this;var s=Xe(this,t);if(!o)for(var u=0;r>u;u++)s.array[u]=void 0;return i&&(s.array[r]=i),s},removeAfter:function(t,e,n){if(n===e?1<<e:0||0===this.array.length)return this;var r=n-1>>>e&En;if(r>=this.array.length)return this;var i,o=r===this.array.length-1;if(e>0){var a=this.array[r];if(i=a&&a.removeAfter(t,e-wn,n),i===a&&o)return this}if(o&&!i)return this;var s=Xe(this,t);return o||s.array.pop(),i&&(s.array[r]=i),s}},{});var Qr=function(t,e,n){this._type=e,this._reverse=!!n,this._maxIndex=t.size-1;var r=tn(t._capacity),i=We(t._root&&t._root.array,t._level,-t._origin,r-t._origin-1),o=We(t._tail&&t._tail.array,0,r-t._origin,t._capacity-t._origin-1);this._stack=n?o:i,this._stack.__prev=n?i:o};gn.createClass(Qr,{next:function(){for(var t=this._stack;t;){var e=t.array,n=t.index++;if(this._reverse&&(n=En-n,n>t.rawMax&&(n=t.rawMax,t.index=Sn-n)),n>=0&&Sn>n&&n<=t.rawMax){var r=e&&e[n];if(0===t.level){var i,o=this._type;return 1!==o&&(i=t.offset+(n<<t.level),this._reverse&&(i=this._maxIndex-i)),S(o,i,r)}this._stack=t=We(r&&r.array,t.level-wn,t.offset+(n<<t.level),t.max,t)}else t=this._stack=this._stack.__prev}return E()}},{},Un);var Xr,Yr=function(t){return null===t||void 0===t?rn():en(t)?t:rn().merge(Yn(t))};gn.createClass(Yr,{toString:function(){return this.__toString("OrderedMap {","}")},get:function(t,e){var n=this._map.get(t);return void 0!==n?this._list.get(n)[1]:e},clear:function(){return 0===this.size?this:this.__ownerID?(this.size=0,this._map.clear(),this._list.clear(),this):rn()},set:function(t,e){return on(this,t,e)},remove:function(t){return on(this,t,Cn)},wasAltered:function(){return this._map.wasAltered()||this._list.wasAltered()},__iterate:function(t,e){var n=this;return this._list.__iterate(function(e){return e&&t(e[1],e[0],n)},e)},__iterator:function(t,e){return this._list.fromEntrySeq().__iterator(t,e)},__ensureOwner:function(t){if(t===this.__ownerID)return this;var e=this._map.__ensureOwner(t),n=this._list.__ensureOwner(t);return t?nn(e,n,t,this.__hash):(this.__ownerID=t,this._map=e,this._list=n,this)}},{of:function(){return this(arguments)}},Sr),Yr.isOrderedMap=en,Yr.prototype[Qn]=!0,Yr.prototype[bn]=Yr.prototype.remove;var Gr,Zr=function(t){return null===t||void 0===t?un():an(t)?t:un().unshiftAll(t)},ti=Zr;gn.createClass(Zr,{toString:function(){return this.__toString("Stack [","]")},get:function(t,e){for(var n=this._head;n&&t--;)n=n.next;return n?n.value:e},peek:function(){return this._head&&this._head.value},push:function(){if(0===arguments.length)return this;for(var t=this.size+arguments.length,e=this._head,n=arguments.length-1;n>=0;n--)e={value:arguments[n],next:e};return this.__ownerID?(this.size=t,this._head=e,this.__hash=void 0,this.__altered=!0,this):sn(t,e)},pushAll:function(t){if(t=Zn(t),0===t.size)return this;var e=this.size,n=this._head;return t.reverse().forEach(function(t){e++,n={value:t,next:n}}),this.__ownerID?(this.size=e,this._head=n,this.__hash=void 0,this.__altered=!0,this):sn(e,n)},pop:function(){return this.slice(1)},unshift:function(){return this.push.apply(this,arguments)},unshiftAll:function(t){return this.pushAll(t)},shift:function(){return this.pop.apply(this,arguments)},clear:function(){return 0===this.size?this:this.__ownerID?(this.size=0,this._head=void 0,this.__hash=void 0,this.__altered=!0,this):un()},slice:function(t,e){if(d(t,e,this.size))return this;var n=p(t,this.size),r=m(e,this.size);if(r!==this.size)return gn.superCall(this,ti.prototype,"slice",[t,e]);for(var i=this.size-n,o=this._head;n--;)o=o.next;return this.__ownerID?(this.size=i,this._head=o,this.__hash=void 0,this.__altered=!0,this):sn(i,o)},__ensureOwner:function(t){return t===this.__ownerID?this:t?sn(this.size,this._head,t,this.__hash):(this.__ownerID=t,this.__altered=!1,this)},__iterate:function(t,e){if(e)return this.toSeq().cacheResult.__iterate(t,e);for(var n=0,r=this._head;r&&t(r.value,n++,this)!==!1;)r=r.next;return n},__iterator:function(t,e){if(e)return this.toSeq().cacheResult().__iterator(t,e);var n=0,r=this._head;return new Un(function(){if(r){var e=r.value;return r=r.next,S(t,n++,e)}return E()})}},{of:function(){return this(arguments)}},yr),Zr.isStack=an;var ei="@@__IMMUTABLE_STACK__@@",ni=Zr.prototype;ni[ei]=!0,ni.withMutations=Cr.withMutations,ni.asMutable=Cr.asMutable,ni.asImmutable=Cr.asImmutable,ni.wasAltered=Cr.wasAltered;var ri,ii=function(t){return null===t||void 0===t?ln():cn(t)?t:ln().union(tr(t))};gn.createClass(ii,{toString:function(){return this.__toString("Set {","}")},has:function(t){return this._map.has(t)},add:function(t){return fn(this,this._map.set(t,!0))},remove:function(t){return fn(this,this._map.remove(t))},clear:function(){return fn(this,this._map.clear())},union:function(){var t=arguments;return 0===t.length?this:this.withMutations(function(e){for(var n=0;n<t.length;n++)tr(t[n]).forEach(function(t){return e.add(t)})})},intersect:function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];if(0===t.length)return this;t=t.map(function(t){return tr(t)});var n=this;return this.withMutations(function(e){n.forEach(function(n){t.every(function(t){return t.contains(n)})||e.remove(n)})})},subtract:function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];if(0===t.length)return this;t=t.map(function(t){return tr(t)});var n=this;return this.withMutations(function(e){n.forEach(function(n){t.some(function(t){return t.contains(n)})&&e.remove(n)})})},merge:function(){return this.union.apply(this,arguments)},mergeWith:function(){for(var t=[],e=1;e<arguments.length;e++)t[e-1]=arguments[e];return this.union.apply(this,t)},sort:function(t){return ui(Te(this,t))},sortBy:function(t,e){return ui(Te(this,e,t))},wasAltered:function(){return this._map.wasAltered()},__iterate:function(t,e){var n=this;return this._map.__iterate(function(e,r){return t(r,r,n)},e)},__iterator:function(t,e){return this._map.map(function(t,e){return e}).__iterator(t,e)},__ensureOwner:function(t){if(t===this.__ownerID)return this;var e=this._map.__ensureOwner(t);return t?this.__make(e,t):(this.__ownerID=t,this._map=e,this)}},{of:function(){return this(arguments)},fromKeys:function(t){return this(Yn(t).keySeq())}},br),ii.isSet=cn;var oi="@@__IMMUTABLE_SET__@@",ai=ii.prototype;ai[oi]=!0,ai[bn]=ai.remove,ai.mergeDeep=ai.merge,ai.mergeDeepWith=ai.mergeWith,ai.withMutations=Cr.withMutations,ai.asMutable=Cr.asMutable,ai.asImmutable=Cr.asImmutable,ai.__empty=ln,ai.__make=hn;var si,ui=function(t){return null===t||void 0===t?mn():dn(t)?t:mn().union(tr(t))};gn.createClass(ui,{toString:function(){return this.__toString("OrderedSet {","}")}},{of:function(){return this(arguments)},fromKeys:function(t){return this(Yn(t).keySeq())}},ii),ui.isOrderedSet=dn;var ci=ui.prototype;ci[Qn]=!0,ci.__empty=mn,ci.__make=pn;var fi,hi=function(t,e){var n=function(t){return this instanceof n?void(this._map=Sr(t)):new n(t)},r=Object.keys(t),o=n.prototype=Object.create(li);o.constructor=n,e&&(o._name=e),o._defaultValues=t,o._keys=r,o.size=r.length;try{r.forEach(function(t){Object.defineProperty(n.prototype,t,{get:function(){return this.get(t)},set:function(e){i(this.__ownerID,"Cannot set on an immutable record."),this.set(t,e)}})})}catch(a){}return n};gn.createClass(hi,{toString:function(){return this.__toString(vn(this)+" {","}")},has:function(t){return this._defaultValues.hasOwnProperty(t)},get:function(t,e){if(!this.has(t))return e;var n=this._defaultValues[t];return this._map?this._map.get(t,n):n},clear:function(){if(this.__ownerID)return this._map&&this._map.clear(),this;var t=Object.getPrototypeOf(this).constructor;return t._empty||(t._empty=_n(this,ie()))},set:function(t,e){if(!this.has(t))throw new Error('Cannot set unknown key "'+t+'" on '+vn(this));var n=this._map&&this._map.set(t,e);return this.__ownerID||n===this._map?this:_n(this,n)},remove:function(t){if(!this.has(t))return this;var e=this._map&&this._map.remove(t);return this.__ownerID||e===this._map?this:_n(this,e)},wasAltered:function(){return this._map.wasAltered()},__iterator:function(t,e){var n=this;return Yn(this._defaultValues).map(function(t,e){return n.get(e)}).__iterator(t,e)},__iterate:function(t,e){var n=this;return Yn(this._defaultValues).map(function(t,e){return n.get(e)}).__iterate(t,e)},__ensureOwner:function(t){if(t===this.__ownerID)return this;var e=this._map&&this._map.__ensureOwner(t);return t?_n(this,e,t):(this.__ownerID=t,this._map=e,this)}},{},_r);var li=hi.prototype;li[bn]=li.remove,li.merge=Cr.merge,li.mergeWith=Cr.mergeWith,li.mergeDeep=Cr.mergeDeep,li.mergeDeepWith=Cr.mergeDeepWith,li.update=Cr.update,li.updateIn=Cr.updateIn,li.withMutations=Cr.withMutations,li.asMutable=Cr.asMutable,li.asImmutable=Cr.asImmutable;var di=function(t,e,n){return this instanceof pi?(i(0!==n,"Cannot step a Range by 0"),t=t||0,void 0===e&&(e=1/0),t===e&&_i?_i:(n=void 0===n?1:Math.abs(n),t>e&&(n=-n),this._start=t,this._end=e,this._step=n,void(this.size=Math.max(0,Math.ceil((e-t)/n-1)+1)))):new pi(t,e,n)},pi=di;gn.createClass(di,{toString:function(){return 0===this.size?"Range []":"Range [ "+this._start+"..."+this._end+(this._step>1?" by "+this._step:"")+" ]"},get:function(t,e){return this.has(t)?this._start+h(this,t)*this._step:e},contains:function(t){var e=(t-this._start)/this._step;return e>=0&&e<this.size&&e===Math.floor(e)},slice:function(t,e){return d(t,e,this.size)?this:(t=p(t,this.size),e=m(e,this.size),t>=e?_i:new pi(this.get(t,this._end),this.get(e,this._end),this._step))},indexOf:function(t){var e=t-this._start;if(e%this._step===0){var n=e/this._step;if(n>=0&&n<this.size)return n}return-1},lastIndexOf:function(t){return this.indexOf(t)},take:function(t){return this.slice(0,Math.max(0,t))},skip:function(t){return this.slice(Math.max(0,t))},__iterate:function(t,e){for(var n=this.size-1,r=this._step,i=e?this._start+n*r:this._start,o=0;n>=o;o++){if(t(i,o,this)===!1)return o+1;i+=e?-r:r}return o},__iterator:function(t,e){var n=this.size-1,r=this._step,i=e?this._start+n*r:this._start,o=0;return new Un(function(){var a=i;return i+=e?-r:r,o>n?E():S(t,o++,a)})},__deepEquals:function(t){return t instanceof pi?this._start===t._start&&this._end===t._end&&this._step===t._step:H(this,t)}},{},or);var mi=di.prototype;mi.__toJS=mi.toArray,mi.first=Jr.first,mi.last=Jr.last;var _i=di(0,0),vi=function(t,e){return 0>=e&&bi?bi:this instanceof yi?(this._value=t,this.size=void 0===e?1/0:Math.max(0,e),void(0===this.size&&(bi=this))):new yi(t,e)},yi=vi;gn.createClass(vi,{toString:function(){return 0===this.size?"Repeat []":"Repeat [ "+this._value+" "+this.size+" times ]"},get:function(t,e){return this.has(t)?this._value:e},contains:function(t){return r(this._value,t)},slice:function(t,e){var n=this.size;return d(t,e,n)?this:new yi(this._value,m(e,n)-p(t,n))},reverse:function(){return this},indexOf:function(t){return r(this._value,t)?0:-1},lastIndexOf:function(t){return r(this._value,t)?this.size:-1},__iterate:function(t){for(var e=0;e<this.size;e++)if(t(this._value,e,this)===!1)return e+1;return e},__iterator:function(t){var e=this,n=0;return new Un(function(){return n<e.size?S(t,n++,e._value):E()})},__deepEquals:function(t){return t instanceof yi?r(this._value,t._value):H(t)}},{},or);var gi=vi.prototype;gi.last=gi.first,gi.has=mi.has,gi.take=mi.take,gi.skip=mi.skip,gi.__toJS=mi.__toJS;var bi,wi={Iterable:Fn,Seq:er,Collection:mr,Map:Sr,OrderedMap:Yr,List:Fr,Stack:Zr,Set:ii,OrderedSet:ui,Record:hi,Range:di,Repeat:vi,is:r,fromJS:X};return wi}define("lodash-amd/modern/internals/isNative",[],function(){function t(t){return"function"==typeof t&&r.test(t)}var e=Object.prototype,n=e.toString,r=RegExp("^"+String(n).replace(/[.*+?^${}()|[\]\\]/g,"\\$&").replace(/toString| for [^\]]+/g,".*?")+"$");return t}),define("lodash-amd/modern/internals/objectTypes",[],function(){var t={"boolean":!1,"function":!0,object:!0,number:!1,string:!1,undefined:!1};return t}),define("lodash-amd/modern/objects/isObject",["../internals/objectTypes"],function(t){function e(e){return!(!e||!t[typeof e])}return e}),define("lodash-amd/modern/internals/shimKeys",["./objectTypes"],function(t){var e=Object.prototype,n=e.hasOwnProperty,r=function(e){var r,i=e,o=[];if(!i)return o;if(!t[typeof e])return o;for(r in i)n.call(i,r)&&o.push(r);return o};return r}),define("lodash-amd/modern/objects/keys",["../internals/isNative","./isObject","../internals/shimKeys"],function(t,e,n){var r=t(r=Object.keys)&&r,i=r?function(t){return e(t)?r(t):[]}:n;return i}),define("lodash-amd/modern/objects/defaults",["./keys","../internals/objectTypes"],function(t,e){var n=function(n,r,i){var o,a=n,s=a;if(!a)return s;for(var u=arguments,c=0,f="number"==typeof i?2:u.length;++c<f;)if(a=u[c],a&&e[typeof a])for(var h=-1,l=e[typeof a]&&t(a),d=l?l.length:0;++h<d;)o=l[h],"undefined"==typeof s[o]&&(s[o]=a[o]);return s};return n}),define("plugins/core/commands/indent",[],function(){return function(){return function(t){var e=new t.api.Command("indent");e.queryEnabled=function(){var e=new t.api.Selection,n=e.getContaining(function(t){return"UL"===t.nodeName||"OL"===t.nodeName});return t.api.Command.prototype.queryEnabled.call(this)&&t.allowsBlockElements()&&!n},t.commands.indent=e}}}),define("plugins/core/commands/insert-list",[],function(){return function(){return function(t){var e=function(e){t.api.Command.call(this,e)};e.prototype=Object.create(t.api.Command.prototype),e.prototype.constructor=e,e.prototype.execute=function(e){function n(t){if(t.length>0){var e=document.createElement(o.nodeName);t.forEach(function(t){e.appendChild(t)}),o.parentNode.insertBefore(e,o.nextElementSibling)}}if(this.queryState()){var r=new t.api.Selection,i=r.range,o=r.getContaining(function(t){return"OL"===t.nodeName||"UL"===t.nodeName}),a=r.getContaining(function(t){return"LI"===t.nodeName});t.transactionManager.run(function(){if(a){var e=new t.api.Node(a).nextAll();n(e),r.placeMarkers();var s=document.createElement("p");s.innerHTML=a.innerHTML,o.parentNode.insertBefore(s,o.nextElementSibling),a.parentNode.removeChild(a)}else{var u=Array.prototype.map.call(o.querySelectorAll("li"),function(t){return i.intersectsNode(t)&&t}).filter(function(t){return t}),c=u.slice(-1)[0],f=new t.api.Node(c).nextAll();n(f),r.placeMarkers();var h=document.createDocumentFragment();u.forEach(function(t){var e=document.createElement("p");e.innerHTML=t.innerHTML,h.appendChild(e)}),o.parentNode.insertBefore(h,o.nextElementSibling),u.forEach(function(t){t.parentNode.removeChild(t)})}0===o.childNodes.length&&o.parentNode.removeChild(o),r.selectMarkers()}.bind(this))}else t.api.Command.prototype.execute.call(this,e)},e.prototype.queryEnabled=function(){return t.api.Command.prototype.queryEnabled.call(this)&&t.allowsBlockElements()},t.commands.insertOrderedList=new e("insertOrderedList"),t.commands.insertUnorderedList=new e("insertUnorderedList")}}}),define("plugins/core/commands/outdent",[],function(){return function(){return function(t){var e=new t.api.Command("outdent");e.queryEnabled=function(){var e=new t.api.Selection,n=e.getContaining(function(t){return"UL"===t.nodeName||"OL"===t.nodeName});return t.api.Command.prototype.queryEnabled.call(this)&&t.allowsBlockElements()&&!n},t.commands.outdent=e}}}),define("plugins/core/commands/redo",[],function(){return function(){return function(t){var e=new t.api.Command("redo");e.execute=function(){var e=t.undoManager.redo();"undefined"!=typeof e&&t.restoreFromHistory(e)},e.queryEnabled=function(){return t.undoManager.position<t.undoManager.stack.length-1},t.commands.redo=e,t.el.addEventListener("keydown",function(t){t.shiftKey&&(t.metaKey||t.ctrlKey)&&90===t.keyCode&&(t.preventDefault(),e.execute())})}}}),define("plugins/core/commands/subscript",[],function(){return function(){return function(t){var e=new t.api.Command("subscript");t.commands.subscript=e}}}),define("plugins/core/commands/superscript",[],function(){return function(){return function(t){var e=new t.api.Command("superscript");t.commands.superscript=e}}}),define("plugins/core/commands/undo",[],function(){return function(){return function(t){var e=new t.api.Command("undo");e.execute=function(){var e=t.undoManager.undo();"undefined"!=typeof e&&t.restoreFromHistory(e)},e.queryEnabled=function(){return t.undoManager.position>1},t.commands.undo=e,t.el.addEventListener("keydown",function(t){t.shiftKey||!t.metaKey&&!t.ctrlKey||90!==t.keyCode||(t.preventDefault(),e.execute())})}}}),define("plugins/core/commands",["./commands/indent","./commands/insert-list","./commands/outdent","./commands/redo","./commands/subscript","./commands/superscript","./commands/undo"],function(t,e,n,r,i,o,a){return{indent:t,insertList:e,outdent:n,redo:r,subscript:i,superscript:o,undo:a}}),define("lodash-amd/modern/internals/baseIndexOf",[],function(){function t(t,e,n){for(var r=(n||0)-1,i=t?t.length:0;++r<i;)if(t[r]===e)return r;return-1}return t}),define("lodash-amd/modern/utilities/noop",[],function(){function t(){}return t}),define("lodash-amd/modern/internals/baseCreate",["./isNative","../objects/isObject","../utilities/noop"],function(t,e){function n(t){return e(t)?r(t):{}}var r=t(r=Object.create)&&r;return r||(n=function(){function t(){}return function(n){if(e(n)){t.prototype=n;var r=new t;t.prototype=null}return r||window.Object()}}()),n}),define("lodash-amd/modern/internals/setBindData",["./isNative","../utilities/noop"],function(t,e){var n={configurable:!1,enumerable:!1,value:null,writable:!1},r=function(){try{var e={},n=t(n=Object.defineProperty)&&n,r=n(e,e,e)&&n}catch(i){}return r}(),i=r?function(t,e){n.value=e,r(t,"__bindData__",n)}:e;return i}),define("lodash-amd/modern/internals/slice",[],function(){function t(t,e,n){e||(e=0),"undefined"==typeof n&&(n=t?t.length:0);for(var r=-1,i=n-e||0,o=Array(0>i?0:i);++r<i;)o[r]=t[e+r];return o}return t}),define("lodash-amd/modern/internals/baseBind",["./baseCreate","../objects/isObject","./setBindData","./slice"],function(t,e,n,r){function i(i){function o(){if(u){var n=r(u);a.apply(n,arguments)}if(this instanceof o){var i=t(s.prototype),f=s.apply(i,n||arguments);return e(f)?f:i}return s.apply(c,n||arguments)}var s=i[0],u=i[2],c=i[4];return n(o,i),o}var o=[],a=o.push;return i}),define("lodash-amd/modern/internals/baseCreateWrapper",["./baseCreate","../objects/isObject","./setBindData","./slice"],function(t,e,n,r){function i(o){function s(){var n=p?l:this;if(f){var o=r(f);a.apply(o,arguments)}if((h||_)&&(o||(o=r(arguments)),h&&a.apply(o,h),_&&o.length<d))return c|=16,i([u,v?c:-4&c,o,null,l,d]);if(o||(o=arguments),m&&(u=n[y]),this instanceof s){n=t(u.prototype);var g=u.apply(n,o);return e(g)?g:n}return u.apply(n,o)}var u=o[0],c=o[1],f=o[2],h=o[3],l=o[4],d=o[5],p=1&c,m=2&c,_=4&c,v=8&c,y=u;return n(s,o),s}var o=[],a=o.push;return i}),define("lodash-amd/modern/objects/isFunction",[],function(){function t(t){return"function"==typeof t}return t}),define("lodash-amd/modern/internals/createWrapper",["./baseBind","./baseCreateWrapper","../objects/isFunction","./slice"],function(t,e,n,r){function i(o,u,c,f,h,l){var d=1&u,p=2&u,m=4&u,_=16&u,v=32&u;if(!p&&!n(o))throw new TypeError;_&&!c.length&&(u&=-17,_=c=!1),v&&!f.length&&(u&=-33,v=f=!1);var y=o&&o.__bindData__;if(y&&y!==!0)return y=r(y),y[2]&&(y[2]=r(y[2])),y[3]&&(y[3]=r(y[3])),!d||1&y[1]||(y[4]=h),!d&&1&y[1]&&(u|=8),!m||4&y[1]||(y[5]=l),_&&a.apply(y[2]||(y[2]=[]),c),v&&s.apply(y[3]||(y[3]=[]),f),y[1]|=u,i.apply(null,y);var g=1==u||17===u?t:e;return g([o,u,c,f,h,l])}var o=[],a=o.push,s=o.unshift;return i}),define("lodash-amd/modern/functions/bind",["../internals/createWrapper","../internals/slice"],function(t,e){function n(n,r){return arguments.length>2?t(n,17,e(arguments,2),null,r):t(n,1,null,null,r)}return n}),define("lodash-amd/modern/utilities/identity",[],function(){function t(t){return t}return t}),define("lodash-amd/modern/support",["./internals/isNative"],function(t){var e=/\bthis\b/,n={};return n.funcDecomp=!t(window.WinRTError)&&e.test(function(){return this}),n.funcNames="string"==typeof Function.name,n}),define("lodash-amd/modern/internals/baseCreateCallback",["../functions/bind","../utilities/identity","./setBindData","../support"],function(t,e,n,r){function i(i,u,c){if("function"!=typeof i)return e;if("undefined"==typeof u||!("prototype"in i))return i;var f=i.__bindData__;if("undefined"==typeof f&&(r.funcNames&&(f=!i.name),f=f||!r.funcDecomp,!f)){var h=s.call(i);r.funcNames||(f=!o.test(h)),f||(f=a.test(h),n(i,f))}if(f===!1||f!==!0&&1&f[1])return i;switch(c){case 1:return function(t){return i.call(u,t)};case 2:return function(t,e){return i.call(u,t,e)};case 3:return function(t,e,n){return i.call(u,t,e,n)};case 4:return function(t,e,n,r){return i.call(u,t,e,n,r)}}return t(i,u)}var o=/^\s*function[ \n\r\t]+\w/,a=/\bthis\b/,s=Function.prototype.toString;return i}),define("lodash-amd/modern/objects/forOwn",["../internals/baseCreateCallback","./keys","../internals/objectTypes"],function(t,e,n){var r=function(r,i,o){var a,s=r,u=s;if(!s)return u;if(!n[typeof s])return u;i=i&&"undefined"==typeof o?i:t(i,o,3);for(var c=-1,f=n[typeof s]&&e(s),h=f?f.length:0;++c<h;)if(a=f[c],i(s[a],a,r)===!1)return u;return u};return r}),define("lodash-amd/modern/objects/isArray",["../internals/isNative"],function(t){var e="[object Array]",n=Object.prototype,r=n.toString,i=t(i=Array.isArray)&&i,o=i||function(t){return t&&"object"==typeof t&&"number"==typeof t.length&&r.call(t)==e||!1};return o}),define("lodash-amd/modern/objects/isString",[],function(){function t(t){return"string"==typeof t||t&&"object"==typeof t&&r.call(t)==e||!1}var e="[object String]",n=Object.prototype,r=n.toString;return t}),define("lodash-amd/modern/collections/contains",["../internals/baseIndexOf","../objects/forOwn","../objects/isArray","../objects/isString"],function(t,e,n,r){function i(i,a,s){var u=-1,c=t,f=i?i.length:0,h=!1;return s=(0>s?o(0,f+s):s)||0,n(i)?h=c(i,a,s)>-1:"number"==typeof f?h=(r(i)?i.indexOf(a,s):c(i,a,s))>-1:e(i,function(t){return++u>=s?!(h=t===a):void 0
}),h}var o=Math.max;return i}),define("lodash-amd/modern/objects/isArguments",[],function(){function t(t){return t&&"object"==typeof t&&"number"==typeof t.length&&r.call(t)==e||!1}var e="[object Arguments]",n=Object.prototype,r=n.toString;return t}),define("lodash-amd/modern/internals/baseFlatten",["../objects/isArguments","../objects/isArray"],function(t,e){function n(r,i,o,a){for(var s=(a||0)-1,u=r?r.length:0,c=[];++s<u;){var f=r[s];if(f&&"object"==typeof f&&"number"==typeof f.length&&(e(f)||t(f))){i||(f=n(f,i,o));var h=-1,l=f.length,d=c.length;for(c.length+=l;++h<l;)c[d++]=f[h]}else o||c.push(f)}return c}return n}),define("lodash-amd/modern/objects/forIn",["../internals/baseCreateCallback","../internals/objectTypes"],function(t,e){var n=function(n,r,i){var o,a=n,s=a;if(!a)return s;if(!e[typeof a])return s;r=r&&"undefined"==typeof i?r:t(r,i,3);for(o in a)if(r(a[o],o,n)===!1)return s;return s};return n}),define("lodash-amd/modern/internals/arrayPool",[],function(){var t=[];return t}),define("lodash-amd/modern/internals/getArray",["./arrayPool"],function(t){function e(){return t.pop()||[]}return e}),define("lodash-amd/modern/internals/maxPoolSize",[],function(){var t=40;return t}),define("lodash-amd/modern/internals/releaseArray",["./arrayPool","./maxPoolSize"],function(t,e){function n(n){n.length=0,t.length<e&&t.push(n)}return n}),define("lodash-amd/modern/internals/baseIsEqual",["../objects/forIn","./getArray","../objects/isFunction","./objectTypes","./releaseArray"],function(t,e,n,r,i){function o(p,v,y,g,b,w){if(y){var S=y(p,v);if("undefined"!=typeof S)return!!S}if(p===v)return 0!==p||1/p==1/v;var E=typeof p,C=typeof v;if(!(p!==p||p&&r[E]||v&&r[C]))return!1;if(null==p||null==v)return p===v;var M=m.call(p),k=m.call(v);if(M==a&&(M=h),k==a&&(k=h),M!=k)return!1;switch(M){case u:case c:return+p==+v;case f:return p!=+p?v!=+v:0==p?1/p==1/v:p==+v;case l:case d:return p==String(v)}var x=M==s;if(!x){var N=_.call(p,"__wrapped__"),z=_.call(v,"__wrapped__");if(N||z)return o(N?p.__wrapped__:p,z?v.__wrapped__:v,y,g,b,w);if(M!=h)return!1;var I=p.constructor,O=v.constructor;if(I!=O&&!(n(I)&&I instanceof I&&n(O)&&O instanceof O)&&"constructor"in p&&"constructor"in v)return!1}var A=!b;b||(b=e()),w||(w=e());for(var L=b.length;L--;)if(b[L]==p)return w[L]==v;var T=0;if(S=!0,b.push(p),w.push(v),x){if(L=p.length,T=v.length,S=T==L,S||g)for(;T--;){var q=L,j=v[T];if(g)for(;q--&&!(S=o(p[q],j,y,g,b,w)););else if(!(S=o(p[T],j,y,g,b,w)))break}}else t(v,function(t,e,n){return _.call(n,e)?(T++,S=_.call(p,e)&&o(p[e],t,y,g,b,w)):void 0}),S&&!g&&t(p,function(t,e,n){return _.call(n,e)?S=--T>-1:void 0});return b.pop(),w.pop(),A&&(i(b),i(w)),S}var a="[object Arguments]",s="[object Array]",u="[object Boolean]",c="[object Date]",f="[object Number]",h="[object Object]",l="[object RegExp]",d="[object String]",p=Object.prototype,m=p.toString,_=p.hasOwnProperty;return o}),define("lodash-amd/modern/utilities/property",[],function(){function t(t){return function(e){return e[t]}}return t}),define("lodash-amd/modern/functions/createCallback",["../internals/baseCreateCallback","../internals/baseIsEqual","../objects/isObject","../objects/keys","../utilities/property"],function(t,e,n,r,i){function o(o,a,s){var u=typeof o;if(null==o||"function"==u)return t(o,a,s);if("object"!=u)return i(o);var c=r(o),f=c[0],h=o[f];return 1!=c.length||h!==h||n(h)?function(t){for(var n=c.length,r=!1;n--&&(r=e(t[c[n]],o[c[n]],null,!0)););return r}:function(t){var e=t[f];return h===e&&(0!==h||1/h==1/e)}}return o}),define("lodash-amd/modern/collections/map",["../functions/createCallback","../objects/forOwn"],function(t,e){function n(n,r,i){var o=-1,a=n?n.length:0;if(r=t(r,i,3),"number"==typeof a)for(var s=Array(a);++o<a;)s[o]=r(n[o],o,n);else s=[],e(n,function(t,e,n){s[++o]=r(t,e,n)});return s}return n}),define("lodash-amd/modern/arrays/flatten",["../internals/baseFlatten","../collections/map"],function(t,e){function n(n,r,i,o){return"boolean"!=typeof r&&null!=r&&(o=i,i="function"!=typeof r&&o&&o[r]===n?null:r,r=!1),null!=i&&(n=e(n,i,o)),t(n,r)}return n}),define("lodash-amd/modern/objects/values",["./keys"],function(t){function e(e){for(var n=-1,r=t(e),i=r.length,o=Array(i);++n<i;)o[n]=e[r[n]];return o}return e}),define("lodash-amd/modern/collections/toArray",["../objects/isString","../internals/slice","../objects/values"],function(t,e,n){function r(t){return t&&"number"==typeof t.length?e(t):n(t)}return r}),define("element",["lodash-amd/modern/collections/contains"],function(t){function e(e){return t(o,e.nodeName)}function n(t){return t.nodeType===Node.ELEMENT_NODE&&"scribe-marker"===t.className}function r(t){return t.nodeType===Node.ELEMENT_NODE&&"caret-position"===t.className}function i(t,e){for(;e.childNodes.length>0;)t.insertBefore(e.childNodes[0],e);t.removeChild(e)}var o=["P","LI","DIV","BLOCKQUOTE","UL","OL","H1","H2","H3","H4","H5","H6","TABLE","TH","TD"];return{isBlockElement:e,isSelectionMarkerNode:n,isCaretPositionNode:r,unwrap:i}}),define("node",[],function(){function t(t){return t.nodeType===Node.TEXT_NODE&&""===t.textContent}function e(t,e){return e.parentNode.insertBefore(t,e.nextSibling)}function n(t){return t.parentNode.removeChild(t)}return{isEmptyTextNode:t,insertAfter:e,removeNode:n}}),define("dom-observer",["lodash-amd/modern/arrays/flatten","lodash-amd/modern/collections/toArray","./element","./node"],function(t,e,n,r){function i(i,o){function a(i){var o=t(i.map(function(t){var n=e(t.addedNodes),r=e(t.removedNodes);return n.concat(r)})),a=o.filter(function(t){return!r.isEmptyTextNode(t)}).filter(function(t){return!n.isSelectionMarkerNode(t)});return a.length>0}var s=window.MutationObserver||window.WebKitMutationObserver||window.MozMutationObserver,u=!1,c=new s(function(t){if(!u&&a(t)){u=!0;try{o()}catch(e){throw e}finally{setTimeout(function(){u=!1},0)}}});return c.observe(i,{attributes:!0,childList:!0,subtree:!0}),c}return i}),define("plugins/core/events",["lodash-amd/modern/collections/contains","../../dom-observer"],function(t,e){return function(){return function(n){var r=function(){setTimeout(function(){n.pushHistory()}.bind(n),0),n.el.removeEventListener("focus",r)}.bind(n);n.el.addEventListener("focus",r),n.el.addEventListener("focus",function(){function t(e){var n=document.createTreeWalker(e),r=n.currentNode;return n.firstChild()?"BR"===n.currentNode.nodeName?r:t(n.currentNode):n.currentNode}var e=new n.api.Selection;if(e.range){var r=n.allowsBlockElements()&&e.range.startContainer===n.el;if(r){var i=t(n.el.firstChild),o=e.range;o.setStart(i,0),o.setEnd(i,0),e.selection.removeAllRanges(),e.selection.addRange(o)}}}.bind(n));var i=function(){if(!n._skipFormatters){var t=new n.api.Selection,e=t.range,r=function(){e&&t.placeMarkers(),n.setHTML(n._htmlFormatterFactory.format(n.getHTML())),t.selectMarkers()}.bind(n);e?(n.undoManager.undo(),n.transactionManager.run(r)):r()}delete n._skipFormatters}.bind(n);e(n.el,i),n.allowsBlockElements()&&n.el.addEventListener("keydown",function(t){if(13===t.keyCode){var e=new n.api.Selection,r=e.range,i=e.getContaining(function(t){return/^(H[1-6])$/.test(t.nodeName)});if(i&&r.collapsed){var o=r.cloneRange();o.setEndAfter(i,0);var a=o.cloneContents();""===a.firstChild.textContent&&(t.preventDefault(),n.transactionManager.run(function(){var t=document.createElement("p"),n=document.createElement("br");t.appendChild(n),i.parentNode.insertBefore(t,i.nextElementSibling),r.setStart(t,0),r.setEnd(t,0),e.selection.removeAllRanges(),e.selection.addRange(r)}))}}}),n.allowsBlockElements()&&n.el.addEventListener("keydown",function(t){if(13===t.keyCode||8===t.keyCode){var e=new n.api.Selection,r=e.range;if(r.collapsed){var i=e.getContaining(function(t){return"LI"===t.nodeName});if(i&&""===i.textContent.trim()){t.preventDefault();var o=e.getContaining(function(t){return"UL"===t.nodeName||"OL"===t.nodeName}),a=n.getCommand("OL"===o.nodeName?"insertOrderedList":"insertUnorderedList");a.execute()}}}}),n.el.addEventListener("paste",function(e){if(e.clipboardData)e.preventDefault(),t(e.clipboardData.types,"text/html")?n.insertHTML(e.clipboardData.getData("text/html")):n.insertPlainText(e.clipboardData.getData("text/plain"));else{var r=new n.api.Selection;r.placeMarkers();var i=document.createElement("div");document.body.appendChild(i),i.setAttribute("contenteditable",!0),i.focus(),setTimeout(function(){var t=i.innerHTML;i.parentNode.removeChild(i),r.selectMarkers(),n.el.focus(),n.insertHTML(t)},1)}})}}}),define("plugins/core/formatters/html/replace-nbsp-chars",[],function(){return function(){return function(t){var e=/(\s|&nbsp;)+/g;t.registerHTMLFormatter("export",function(t){return t.replace(e," ")})}}}),define("lodash-amd/modern/arrays/last",["../functions/createCallback","../internals/slice"],function(t,e){function n(n,o,a){var s=0,u=n?n.length:0;if("number"!=typeof o&&null!=o){var c=u;for(o=t(o,a,3);c--&&o(n[c],c,n);)s++}else if(s=o,null==s||a)return n?n[u-1]:r;return e(n,i(0,u-s))}var r,i=Math.max;return n}),define("plugins/core/formatters/html/enforce-p-elements",["lodash-amd/modern/arrays/last"],function(t){function e(e,n){var r=Array.prototype.reduce.call(n.childNodes,function(n,r){function i(){var t=[r];n.push(t)}var o=t(n);if(o){var a=e.element.isBlockElement(o[0]);a===e.element.isBlockElement(r)?o.push(r):i()}else i();return n},[]),i=r.filter(function(t){var n=e.element.isBlockElement(t[0]);return!n});i.forEach(function(t){var e=document.createElement("p");t[0].parentNode.insertBefore(e,t[0]),t.forEach(function(t){e.appendChild(t)})}),n._isWrapped=!0}function n(t,r){for(var i=document.createTreeWalker(r,NodeFilter.SHOW_ELEMENT),o=i.firstChild();o;){if("BLOCKQUOTE"===o.nodeName&&!o._isWrapped){e(t,o),n(t,r);break}o=i.nextSibling()}}return function(){return function(t){t.registerHTMLFormatter("normalize",function(r){var i=document.createElement("div");return i.innerHTML=r,e(t,i),n(t,i),i.innerHTML})}}}),define("plugins/core/formatters/html/ensure-selectable-containers",["../../../../element","lodash-amd/modern/collections/contains"],function(t,e){function n(t,e){return t.isCaretPositionNode(e)?!0:""===e.parentNode.textContent.trim()}function r(t,o){function a(e){return 0===e.children.length&&t.isBlockElement(e)||1===e.children.length&&t.isSelectionMarkerNode(e.children[0])?!0:t.isBlockElement(e)||0!==e.children.length?!1:n(t,e)}for(var s=o.firstElementChild;s;)t.isSelectionMarkerNode(s)||(a(s)&&""===s.textContent.trim()&&!e(i,s.nodeName)?s.appendChild(document.createElement("br")):s.children.length>0&&r(t,s)),s=s.nextElementSibling}var i=["AREA","BASE","BR","COL","COMMAND","EMBED","HR","IMG","INPUT","KEYGEN","LINK","META","PARAM","SOURCE","TRACK","WBR"];return function(){return function(t){t.registerHTMLFormatter("normalize",function(e){var n=document.createElement("div");return n.innerHTML=e,r(t.element,n),n.innerHTML})}}}),define("lodash-amd/modern/internals/htmlEscapes",[],function(){var t={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"};return t}),define("lodash-amd/modern/internals/escapeHtmlChar",["./htmlEscapes"],function(t){function e(e){return t[e]}return e}),define("lodash-amd/modern/internals/reUnescapedHtml",["./htmlEscapes","../objects/keys"],function(t,e){var n=RegExp("["+e(t).join("")+"]","g");return n}),define("lodash-amd/modern/utilities/escape",["../internals/escapeHtmlChar","../objects/keys","../internals/reUnescapedHtml"],function(t,e,n){function r(e){return null==e?"":String(e).replace(n,t)}return r}),define("plugins/core/formatters/plain-text/escape-html-characters",["lodash-amd/modern/utilities/escape"],function(t){return function(){return function(e){e.registerPlainTextFormatter(t)}}}),define("plugins/core/inline-elements-mode",[],function(){function t(t){for(var e=document.createTreeWalker(t);e.nextNode();)if(e.currentNode&&(~["br"].indexOf(e.currentNode.nodeName.toLowerCase())||e.currentNode.length>0))return!0;return!1}return function(){return function(e){e.el.addEventListener("keydown",function(n){if(13===n.keyCode){var r=new e.api.Selection,i=r.range,o=r.getContaining(function(t){return"LI"===t.nodeName||/^(H[1-6])$/.test(t.nodeName)});o||(n.preventDefault(),e.transactionManager.run(function(){"BR"===e.el.lastChild.nodeName&&e.el.removeChild(e.el.lastChild);var n=document.createElement("br");i.insertNode(n),i.collapse(!1);var o=i.cloneRange();o.setEndAfter(e.el.lastChild,0);var a=o.cloneContents();if(!t(a)){var s=document.createElement("br");i.insertNode(s)}var u=i.cloneRange();u.setStartAfter(n,0),u.setEndAfter(n,0),r.selection.removeAllRanges(),r.selection.addRange(u)}))}}.bind(this)),""===e.getHTML().trim()&&e.setContent("")}}}),define("plugins/core/patches/commands/bold",[],function(){return function(){return function(t){var e=new t.api.CommandPatch("bold");e.queryEnabled=function(){var e=new t.api.Selection,n=e.getContaining(function(t){return/^(H[1-6])$/.test(t.nodeName)});return t.api.CommandPatch.prototype.queryEnabled.apply(this,arguments)&&!n},t.commandPatches.bold=e}}}),define("plugins/core/patches/commands/indent",[],function(){var t="";return function(){return function(e){var n=new e.api.CommandPatch("indent");n.execute=function(n){e.transactionManager.run(function(){var r=new e.api.Selection,i=r.range,o="P"===i.commonAncestorContainer.nodeName&&"<br>"===i.commonAncestorContainer.innerHTML;if(o){var a=document.createTextNode(t);i.insertNode(a),i.setStart(a,0),i.setEnd(a,0),r.selection.removeAllRanges(),r.selection.addRange(i)}e.api.CommandPatch.prototype.execute.call(this,n),r=new e.api.Selection;var s=r.getContaining(function(t){return"BLOCKQUOTE"===t.nodeName});s&&s.removeAttribute("style")}.bind(this))},e.commandPatches.indent=n}}}),define("plugins/core/patches/commands/insert-html",[],function(){return function(){return function(t){var e=new t.api.CommandPatch("insertHTML"),n=t.element;e.execute=function(e){t.transactionManager.run(function(){function r(t){var e=document.createTreeWalker(t,NodeFilter.SHOW_ELEMENT),i=e.firstChild();if(i)do"SPAN"===i.nodeName?n.unwrap(t,i):(i.style.lineHeight=null,""===i.getAttribute("style")&&i.removeAttribute("style")),r(i);while(i=e.nextSibling())}t.api.CommandPatch.prototype.execute.call(this,e),r(t.el)}.bind(this))},t.commandPatches.insertHTML=e}}}),define("plugins/core/patches/commands/insert-list",[],function(){return function(){return function(t){var e=t.element,n=t.node,r=function(e){t.api.CommandPatch.call(this,e)};r.prototype=Object.create(t.api.CommandPatch.prototype),r.prototype.constructor=r,r.prototype.execute=function(r){t.transactionManager.run(function(){if(t.api.CommandPatch.prototype.execute.call(this,r),this.queryState()){var i=new t.api.Selection,o=i.getContaining(function(t){return"OL"===t.nodeName||"UL"===t.nodeName});if(o.nextElementSibling&&0===o.nextElementSibling.childNodes.length&&n.removeNode(o.nextElementSibling),o){var a=o.parentNode;a&&/^(H[1-6]|P)$/.test(a.nodeName)&&(i.placeMarkers(),n.insertAfter(o,a),i.selectMarkers(),2===a.childNodes.length&&n.isEmptyTextNode(a.firstChild)&&n.removeNode(a),0===a.childNodes.length&&n.removeNode(a))}var s=Array.prototype.slice.call(o.childNodes);s.forEach(function(t){var n=Array.prototype.slice.call(t.childNodes);n.forEach(function(n){if("SPAN"===n.nodeName){var r=n;e.unwrap(t,r)}else n.nodeType===Node.ELEMENT_NODE&&(n.style.lineHeight=null,""===n.getAttribute("style")&&n.removeAttribute("style"))})})}}.bind(this))},t.commandPatches.insertOrderedList=new r("insertOrderedList"),t.commandPatches.insertUnorderedList=new r("insertUnorderedList")}}}),define("plugins/core/patches/commands/outdent",[],function(){return function(){return function(t){var e=new t.api.CommandPatch("outdent");e.execute=function(){t.transactionManager.run(function(){var e=new t.api.Selection,n=e.range,r=e.getContaining(function(t){return"BLOCKQUOTE"===t.nodeName});if("BLOCKQUOTE"===n.commonAncestorContainer.nodeName){e.placeMarkers(),e.selectMarkers(!0);var i=n.cloneContents();r.parentNode.insertBefore(i,r),n.deleteContents(),e.selectMarkers(),""===r.textContent&&r.parentNode.removeChild(r)}else{var o=e.getContaining(function(t){return"P"===t.nodeName});if(o){var a=new t.api.Node(o).nextAll();if(a.length){var s=document.createElement(r.nodeName);a.forEach(function(t){s.appendChild(t)}),r.parentNode.insertBefore(s,r.nextElementSibling)}e.placeMarkers(),r.parentNode.insertBefore(o,r.nextElementSibling),e.selectMarkers(),""===r.innerHTML&&r.parentNode.removeChild(r)}else t.api.CommandPatch.prototype.execute.call(this)}}.bind(this))},t.commandPatches.outdent=e}}}),define("plugins/core/patches/commands/create-link",[],function(){return function(){return function(t){var e=new t.api.CommandPatch("createLink");t.commandPatches.createLink=e,e.execute=function(e){var n=new t.api.Selection;if(n.selection.isCollapsed){var r=document.createElement("a");r.setAttribute("href",e),r.textContent=e,n.range.insertNode(r);var i=document.createRange();i.setStartBefore(r),i.setEndAfter(r),n.selection.removeAllRanges(),n.selection.addRange(i)}else t.api.CommandPatch.prototype.execute.call(this,e)}}}}),define("plugins/core/patches/events",[],function(){return function(){return function(t){var e=t.element;t.allowsBlockElements()&&t.el.addEventListener("keyup",function(n){if(8===n.keyCode||46===n.keyCode){var r=new t.api.Selection,i=r.getContaining(function(t){return"P"===t.nodeName});i&&(t.undoManager.undo(),t.transactionManager.run(function(){r.placeMarkers();var t=Array.prototype.slice.call(i.childNodes);t.forEach(function(t){if("SPAN"===t.nodeName){var n=t;e.unwrap(i,n)}else t.nodeType===Node.ELEMENT_NODE&&(t.style.lineHeight=null,""===t.getAttribute("style")&&t.removeAttribute("style"))}),r.selectMarkers()}))}})}}}),define("plugins/core/patches",["./patches/commands/bold","./patches/commands/indent","./patches/commands/insert-html","./patches/commands/insert-list","./patches/commands/outdent","./patches/commands/create-link","./patches/events"],function(t,e,n,r,i,o,a){return{commands:{bold:t,indent:e,insertHTML:n,insertList:r,outdent:i,createLink:o},events:a}}),define("plugins/core/set-root-p-element",[],function(){return function(){return function(t){""===t.getHTML().trim()&&t.setContent("<p><br></p>")}}}),define("api/command-patch",[],function(){return function(t){function e(t){this.commandName=t}return e.prototype.execute=function(e){t.transactionManager.run(function(){document.execCommand(this.commandName,!1,e||null)}.bind(this))},e.prototype.queryState=function(){return document.queryCommandState(this.commandName)},e.prototype.queryEnabled=function(){return document.queryCommandEnabled(this.commandName)},e}}),define("api/command",[],function(){return function(t){function e(e){this.commandName=e,this.patch=t.commandPatches[this.commandName]}return e.prototype.execute=function(e){this.patch?this.patch.execute(e):t.transactionManager.run(function(){document.execCommand(this.commandName,!1,e||null)}.bind(this))},e.prototype.queryState=function(){return this.patch?this.patch.queryState():document.queryCommandState(this.commandName)},e.prototype.queryEnabled=function(){return this.patch?this.patch.queryEnabled():document.queryCommandEnabled(this.commandName)},e}}),define("api/node",[],function(){function t(t){this.node=t}return t.prototype.getAncestor=function(t){var e=function(t){return t&&t.attributes&&t.attributes.getNamedItem("contenteditable")};if(!e(this.node))for(var n=this.node.parentNode;n&&!e(n);){if(t(n))return n;n=n.parentNode}},t.prototype.nextAll=function(){for(var t=[],e=this.node.nextSibling;e;)t.push(e),e=e.nextSibling;return t},t}),define("api/selection",["../element"],function(){return function(t){function e(){this.selection=window.getSelection(),this.selection.rangeCount&&(this.range=this.selection.getRangeAt(0))}return e.prototype.getContaining=function(e){var n=this.range;if(n){var r=new t.api.Node(this.range.commonAncestorContainer),i=r.node&&r.node.attributes&&r.node.attributes.getNamedItem("contenteditable");return!i&&e(r.node)?r.node:r.getAncestor(e)}},e.prototype.placeMarkers=function(){var t=this.range;if(t){var e=document.createElement("em");e.classList.add("scribe-marker");var n=document.createElement("em");n.classList.add("scribe-marker");var r=this.range.cloneRange();if(r.collapse(!1),r.insertNode(n),n.nextSibling&&n.nextSibling.nodeType===Node.TEXT_NODE&&""===n.nextSibling.data&&n.parentNode.removeChild(n.nextSibling),n.previousSibling&&n.previousSibling.nodeType===Node.TEXT_NODE&&""===n.previousSibling.data&&n.parentNode.removeChild(n.previousSibling),!this.selection.isCollapsed){var i=this.range.cloneRange();i.collapse(!0),i.insertNode(e),e.nextSibling&&e.nextSibling.nodeType===Node.TEXT_NODE&&""===e.nextSibling.data&&e.parentNode.removeChild(e.nextSibling),e.previousSibling&&e.previousSibling.nodeType===Node.TEXT_NODE&&""===e.previousSibling.data&&e.parentNode.removeChild(e.previousSibling)}this.selection.removeAllRanges(),this.selection.addRange(this.range)}},e.prototype.getMarkers=function(){return t.el.querySelectorAll("em.scribe-marker")},e.prototype.removeMarkers=function(){var t=this.getMarkers();Array.prototype.forEach.call(t,function(t){t.parentNode.removeChild(t)})},e.prototype.selectMarkers=function(t){var e=this.getMarkers();if(e.length){var n=document.createRange();n.setStartBefore(e[0]),n.setEndAfter(e.length>=2?e[1]:e[0]),t||this.removeMarkers(),this.selection.removeAllRanges(),this.selection.addRange(n)}},e.prototype.isCaretOnNewLine=function(){function t(t){for(var e=document.createTreeWalker(t,NodeFilter.SHOW_ELEMENT),n=e.root;n;){var r=n.childNodes.length;if(r>1||1===r&&""!==n.textContent.trim())return!1;if(0===r)return""===n.textContent.trim();n=e.nextNode()}}var e=this.getContaining(function(t){return"P"===t.nodeName});return e?t(e):!1},e}}),define("api/simple-command",[],function(){return function(t,e){function n(t,n){e.api.Command.call(this,t),this.nodeName=n}return n.prototype=Object.create(t.Command.prototype),n.prototype.constructor=n,n.prototype.queryState=function(){var t=new e.api.Selection;return e.api.Command.prototype.queryState.call(this)&&!!t.getContaining(function(t){return t.nodeName===this.nodeName}.bind(this))},n}}),define("api",["./api/command-patch","./api/command","./api/node","./api/selection","./api/simple-command"],function(t,e,n,r,i){return function(o){this.CommandPatch=t(o),this.Command=e(o),this.Node=n,this.Selection=r(o),this.SimpleCommand=i(this,o)}}),define("lodash-amd/modern/objects/assign",["../internals/baseCreateCallback","./keys","../internals/objectTypes"],function(t,e,n){var r=function(r,i,o){var a,s=r,u=s;if(!s)return u;var c=arguments,f=0,h="number"==typeof o?2:c.length;if(h>3&&"function"==typeof c[h-2])var l=t(c[--h-1],c[h--],2);else h>2&&"function"==typeof c[h-1]&&(l=c[--h]);for(;++f<h;)if(s=c[f],s&&n[typeof s])for(var d=-1,p=n[typeof s]&&e(s),m=p?p.length:0;++d<m;)a=p[d],u[a]=l?l(u[a],s[a]):s[a];return u};return r}),define("transaction-manager",["lodash-amd/modern/objects/assign"],function(t){return function(e){function n(){this.history=[]}return t(n.prototype,{start:function(){this.history.push(1)},end:function(){this.history.pop(),0===this.history.length&&(e.pushHistory(),e.trigger("content-changed"))},run:function(t){this.start();try{t&&t()}finally{this.end()}}}),n}}),define("undo-manager",[],function(){return function(t){function e(){this.position=-1,this.stack=[],this.debug=t.isDebugModeEnabled()}return e.prototype.maxStackSize=100,e.prototype.push=function(t){for(this.debug&&console.log("UndoManager.push: %s",t),this.stack.length=++this.position,this.stack.push(t);this.stack.length>this.maxStackSize;)this.stack.shift(),--this.position},e.prototype.undo=function(){return this.position>0?this.stack[--this.position]:void 0},e.prototype.redo=function(){return this.position<this.stack.length-1?this.stack[++this.position]:void 0},e}}),define("lodash-amd/modern/arrays/pull",[],function(){function t(t){for(var e=arguments,r=0,i=e.length,o=t?t.length:0;++r<i;)for(var a=-1,s=e[r];++a<o;)t[a]===s&&(n.call(t,a--,1),o--);return t}var e=[],n=e.splice;return t}),define("event-emitter",["lodash-amd/modern/arrays/pull"],function(t){function e(){this._listeners={}}return e.prototype.on=function(t,e){var n=this._listeners[t]||[];n.push(e),this._listeners[t]=n},e.prototype.off=function(e,n){var r=this._listeners[e]||[];n?t(r,n):delete this._listeners[e]},e.prototype.trigger=function(t,e){var n=this._listeners[t]||[];n.forEach(function(t){t.apply(null,e)})},e}),"object"==typeof exports?module.exports=universalModule():"function"==typeof define&&define.amd?define("immutable/dist/immutable",universalModule):Immutable=universalModule(),define("scribe",["lodash-amd/modern/objects/defaults","./plugins/core/commands","./plugins/core/events","./plugins/core/formatters/html/replace-nbsp-chars","./plugins/core/formatters/html/enforce-p-elements","./plugins/core/formatters/html/ensure-selectable-containers","./plugins/core/formatters/plain-text/escape-html-characters","./plugins/core/inline-elements-mode","./plugins/core/patches","./plugins/core/set-root-p-element","./api","./transaction-manager","./undo-manager","./event-emitter","./element","./node","immutable/dist/immutable"],function(t,e,n,r,i,o,a,s,u,c,f,h,l,d,p,m,_){function v(v,b){d.call(this),this.el=v,this.commands={},this.options=t(b||{},{allowBlockElements:!0,debug:!1}),this.commandPatches={},this._plainTextFormatterFactory=new y,this._htmlFormatterFactory=new g,this.api=new f(this),this.node=m,this.element=p,this.Immutable=_;var w=h(this);this.transactionManager=new w;var S=l(this);this.undoManager=new S,this.el.setAttribute("contenteditable",!0),this.el.addEventListener("input",function(){this.transactionManager.run()}.bind(this),!1),this.allowsBlockElements()?(this.use(c()),this.use(i()),this.use(o())):this.use(s()),this.use(a()),this.use(r());var E=[u.commands.bold,u.commands.indent,u.commands.insertHTML,u.commands.insertList,u.commands.outdent,u.commands.createLink,u.events],C=[e.indent,e.insertList,e.outdent,e.redo,e.subscript,e.superscript,e.undo],M=[].concat(E,C);M.forEach(function(t){this.use(t())}.bind(this)),this.use(n())}function y(){this.formatters=_.List()}function g(){this.formatters={sanitize:_.List(),normalize:_.List(),"export":_.List()}}return v.prototype=Object.create(d.prototype),v.prototype.use=function(t){return t(this),this},v.prototype.setHTML=function(t,e){e&&(this._skipFormatters=!0),this.el.innerHTML=t},v.prototype.getHTML=function(){return this.el.innerHTML},v.prototype.getContent=function(){return this._htmlFormatterFactory.formatForExport(this.getHTML().replace(/<br>$/,""))},v.prototype.getTextContent=function(){return this.el.textContent},v.prototype.pushHistory=function(){var t=this.undoManager.stack[this.undoManager.position],e=t&&t.replace(/<em class="scribe-marker">/g,"").replace(/<\/em>/g,"");if(!t||t&&this.getHTML()!==e){var n=new this.api.Selection;n.placeMarkers();var r=this.getHTML();return n.removeMarkers(),this.undoManager.push(r),!0}return!1},v.prototype.getCommand=function(t){return this.commands[t]||this.commandPatches[t]||new this.api.Command(t)},v.prototype.restoreFromHistory=function(t){this.setHTML(t,!0);var e=new this.api.Selection;e.selectMarkers(),this.trigger("content-changed")},v.prototype.allowsBlockElements=function(){return this.options.allowBlockElements},v.prototype.setContent=function(t){this.allowsBlockElements()||(t+="<br>"),this.setHTML(t),this.trigger("content-changed")},v.prototype.insertPlainText=function(t){this.insertHTML("<p>"+this._plainTextFormatterFactory.format(t)+"</p>")},v.prototype.insertHTML=function(t){this.getCommand("insertHTML").execute(this._htmlFormatterFactory.format(t))},v.prototype.isDebugModeEnabled=function(){return this.options.debug},v.prototype.registerHTMLFormatter=function(t,e){this._htmlFormatterFactory.formatters[t]=this._htmlFormatterFactory.formatters[t].push(e)},v.prototype.registerPlainTextFormatter=function(t){this._plainTextFormatterFactory.formatters=this._plainTextFormatterFactory.formatters.push(t)},y.prototype.format=function(t){var e=this.formatters.reduce(function(t,e){return e(t)},t);return e},g.prototype=Object.create(y.prototype),g.prototype.constructor=g,g.prototype.format=function(t){var e=this.formatters.sanitize.concat(this.formatters.normalize),n=e.reduce(function(t,e){return e(t)},t);return n},g.prototype.formatForExport=function(t){return this.formatters["export"].reduce(function(t,e){return e(t)},t)},v});//# sourceMappingURL=scribe.min.js.map